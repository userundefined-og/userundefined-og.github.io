

<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" /><title>All Different Variants - Blog of the Dad</title><meta name="Description" content="Technical website about dawnofthe.dad and the like"><meta property="og:title" content="All Different Variants" />
<meta property="og:description" content="In the earlier posts I&rsquo;ve described some of the basic ideas behind CSPs:
how the problems are represented using variables and constraints, how the solver searches for a solution by building up the search tree, how heuristics guide the search, and how constraint propagation helps eliminate parts of the search space that will not contain solutions. In this post I will look at how modeling the problem itself can have a significant influence on how quickly the solver is able to find a solution." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/all-different-variants/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-12T18:21:01-08:00" />
<meta property="article:modified_time" content="2023-11-12T18:21:01-08:00" /><meta property="og:site_name" content="Blog of the Dad" />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="All Different Variants"/>
<meta name="twitter:description" content="In the earlier posts I&rsquo;ve described some of the basic ideas behind CSPs:
how the problems are represented using variables and constraints, how the solver searches for a solution by building up the search tree, how heuristics guide the search, and how constraint propagation helps eliminate parts of the search space that will not contain solutions. In this post I will look at how modeling the problem itself can have a significant influence on how quickly the solver is able to find a solution."/>
      <meta name="twitter:site" content="@userundefinedrd"/>
<meta name="application-name" content="Blog of the Dad">
<meta name="apple-mobile-web-app-title" content="Blog of the Dad">

<meta name="theme-color" content="#f8f8f8"><meta name="twitter:creator" content="@userundefinedrd" /><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

<link rel="canonical" href="http://localhost:1313/posts/all-different-variants/" /><link rel="prev" href="http://localhost:1313/posts/rubber-duck-ftw/" /><link rel="next" href="http://localhost:1313/posts/testing/" />
<link rel="stylesheet" href="/css/main.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">{"@context": "https://schema.org","@type": "BlogPosting",
        "headline": "All Different Variants",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http://localhost:1313/posts/all-different-variants/"
        },"image": ["http://localhost:1313/spongebob-crossed-eyes.jpg"],"genre": "posts","keywords":["Algorithms","Go"],"wordcount":  2843 ,
        "url": "http://localhost:1313/posts/all-different-variants/","datePublished": "2023-11-12T18:21:01-08:00","dateModified": "2023-11-12T18:21:01-08:00","publisher": {
            "@type": "Organization",
            "name": "Andrei"},"author": {
                "@type": "Person",
                "name": "Andrei",
                "url": "/"
            },"description": ""
    }</script></head>

<body header-desktop="" header-mobile=""><script type="text/javascript">
        function setTheme(theme) {
          document.body.setAttribute('theme', theme); 
          document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');
          if (theme === 'light') {
            document.documentElement.classList.remove('tw-dark')
          } else {
            document.documentElement.classList.add('tw-dark')
          }
          window.theme = theme;   
          window.isDark = window.theme !== 'light' 
        }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('' === 'light' || '' === 'dark' || '' === 'black') setTheme(''), saveTheme(''); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop print:!tw-hidden" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Blog of the Dad"><img
        class="logo"
        loading="lazy"
        src="android-chrome-192x192.png"
        srcset="android-chrome-192x192.png, android-chrome-192x192.png 1.5x, android-chrome-192x192.png 2x"
        title="android-chrome-192x192.png" height="36"   width="36" >Blog of the Dad</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item"
                    href="/posts/" > Posts </a><a class="menu-item"
                    href="/tags/" > Tags </a><a class="menu-item"
                    href="/categories/" > Categories </a><span class="menu-item delimiter"></span><button class="menu-item theme-switch" aria-label="Switch Theme">
                    <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
                </button></div>
        </div>
    </div>
</header><header class="mobile print:!tw-hidden" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Blog of the Dad"><img
        class="logo"
        loading="lazy"
        src="android-chrome-192x192.png"
        srcset="android-chrome-192x192.png, android-chrome-192x192.png 1.5x, android-chrome-192x192.png 2x"
        title="android-chrome-192x192.png" >Blog of the Dad</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="" >Posts</a><a class="menu-item" href="/tags/" title="" >Tags</a><a class="menu-item" href="/categories/" title="" >Categories</a><button class="menu-item theme-switch tw-w-full" aria-label="Switch Theme">
                <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
            </button></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
            <div class="container"><div class="toc print:!tw-hidden" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#choices-choices">Choices, choices&hellip;</a></li>
    <li><a href="#all-different-constraint">All different constraint</a>
      <ul>
        <li><a href="#constraint-interface">Constraint interface</a></li>
      </ul>
    </li>
    <li><a href="#all-different-constraint-implementations">All-different constraint implementations</a>
      <ul>
        <li><a href="#binary">Binary</a></li>
        <li><a href="#basic">Basic</a></li>
        <li><a href="#sparse">Sparse</a></li>
        <li><a href="#pigeonhole">Pigeonhole</a></li>
        <li><a href="#bi-partite">Bi-partite</a></li>
      </ul>
    </li>
    <li><a href="#comparing-performance">Comparing performance</a>
      <ul>
        <li><a href="#the-setup">The setup</a></li>
        <li><a href="#steps-taken">Steps taken</a></li>
        <li><a href="#runtime">Runtime</a></li>
        <li><a href="#larger-instances">Larger instances</a></li>
        <li><a href="#even-larger-instances">Even larger instances</a></li>
      </ul>
    </li>
    <li><a href="#takeaways">Takeaways</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single print:!tw-w-full print:!tw-max-w-none print:!tw-m-0 print:!tw-p-0"><h1 class="single-title animate__animated animate__flipInX">All Different Variants</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><img src="http://localhost:1313/drd.jpg" alt="Andrei avatar" class="tw-inline-block tw-max-h-4 tw-rounded-full tw-translate-y-[-2px] tw-mr-1"><a href="/" title="Author" rel=" author" class="author">Andrei</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">category <a href="/categories/constructive-search/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>Constructive Search</a></span></div>
            <div class="post-meta-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;<time datetime="2023-11-12">2023-11-12</time>&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg>&nbsp;<time datetime="2023-11-12">2023-11-12</time>&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;2843 words&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;14 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        
        loading="eager"
        src="/spongebob-crossed-eyes.jpg"
        srcset="/spongebob-crossed-eyes.jpg, /spongebob-crossed-eyes.jpg 1.5x, /spongebob-crossed-eyes.jpg 2x"
        title="/spongebob-crossed-eyes.jpg" ></div><div class="details toc print:!tw-block" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#choices-choices">Choices, choices&hellip;</a></li>
    <li><a href="#all-different-constraint">All different constraint</a>
      <ul>
        <li><a href="#constraint-interface">Constraint interface</a></li>
      </ul>
    </li>
    <li><a href="#all-different-constraint-implementations">All-different constraint implementations</a>
      <ul>
        <li><a href="#binary">Binary</a></li>
        <li><a href="#basic">Basic</a></li>
        <li><a href="#sparse">Sparse</a></li>
        <li><a href="#pigeonhole">Pigeonhole</a></li>
        <li><a href="#bi-partite">Bi-partite</a></li>
      </ul>
    </li>
    <li><a href="#comparing-performance">Comparing performance</a>
      <ul>
        <li><a href="#the-setup">The setup</a></li>
        <li><a href="#steps-taken">Steps taken</a></li>
        <li><a href="#runtime">Runtime</a></li>
        <li><a href="#larger-instances">Larger instances</a></li>
        <li><a href="#even-larger-instances">Even larger instances</a></li>
      </ul>
    </li>
    <li><a href="#takeaways">Takeaways</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>In the earlier posts I&rsquo;ve described some of the basic ideas behind CSPs:</p>
<ul>
<li>how the problems are represented using variables and constraints,</li>
<li>how the solver searches for a solution by building up the search tree,</li>
<li>how heuristics guide the search, and</li>
<li>how constraint propagation helps eliminate parts of the search space that will not contain solutions.</li>
</ul>
<p>In this post I will look at how modeling the problem itself can have a significant influence on how quickly the solver is able to find a solution. In particular, I&rsquo;ll talk about different ways of implementing the <em>all-different</em> constraint, and look at the various implementations&rsquo; performance characteristics.</p>
<h2 id="choices-choices" class="headerLink">
    <a href="#choices-choices" class="header-mark"></a>Choices, choices&hellip;</h2><p>An interesting thing about CSPs is that for a given problem type there is often more than one way to model it. For example, when I spoke about <a href="http://localhost:1313/posts/solver-basics/" rel="">modeling the N-queens problem</a> I said that one way to prevent queens from attacking each other diagonally is to ensure that if any pair of queens are connected by a line the slope of that line isn&rsquo;t 1 or -1. Another way to achieve the same result is to enumerate diagonals of the NxN chessboard, and make sure that all queens are assigned to different diagonals (each queen will claim two diagonals - one from bottom left to top right and another from top left to bottom right). Both representations are totally valid, but the performance of search will vary depending on how the problem is modeled, and how the underlying constraints are implemented.</p>
<p>In fact, the &ldquo;all diagonals must be different&rdquo; constraint can be implemented by having binary constraints, one for each pair of queens, that ensure that the queens don&rsquo;t each other diagonally, which is exactly how I&rsquo;ve described the problem originally. Importantly though, the all-different constraint could be implemented very differently.</p>
<h2 id="all-different-constraint" class="headerLink">
    <a href="#all-different-constraint" class="header-mark"></a>All different constraint</h2><p>Before getting too far ahead, let&rsquo;s formally define what an <em>all-different</em> constraint means. Recall that a CSP itself is composed of variables, each with a domain of possible values, and constraints on those variables. An <em>all-different</em> constraint may defined on any subset of variables of the overall problem, and it is satisfied if the following condition is true:
$$ \forall u, v \in C_V: value(u) \ne value(v) $$</p>
<p>From this representation, it&rsquo;s easy to see why it can be tempting, and totally valid, to model this constraint just as a set of binary <em>not-equals</em> constraints.</p>
<h3 id="constraint-interface" class="headerLink">
    <a href="#constraint-interface" class="header-mark"></a>Constraint interface</h3><p>In my solver all constraints implement the following interface:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Constraint</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Variables</span><span class="p">()</span> <span class="p">[]</span><span class="o">*</span><span class="nx">Variable</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Supported</span><span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">Variable</span><span class="p">,</span> <span class="nx">val</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When the solver applies constraint propagation it checks constraints by iterating over its <code>Variables()</code> and checking whether the remaining values in each of the variable&rsquo;s live domains are still <code>Supported()</code> by the constraint. When they are not, they are removed as no solution can exist with that variable-value assignment. You can see how constraint propagation works in the <a href="http://localhost:1313/posts/constraint-propagation/" rel="">earlier post</a>.</p>
<h2 id="all-different-constraint-implementations" class="headerLink">
    <a href="#all-different-constraint-implementations" class="header-mark"></a>All-different constraint implementations</h2><p>There are many ways to enforce this constraint. Let&rsquo;s look at a bunch.</p>
<h3 id="binary" class="headerLink">
    <a href="#binary" class="header-mark"></a>Binary</h3><p>We&rsquo;ve already covered the simplest, which boils down to taking each pair of variables and adding binary <em>not-equal</em> constraints. This is exactly what we did with N-queens, and results in a quadratic number of binary constraints. One big benefit of this approach is just how easy it is to understand and implement.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">buildBinaryAllDiff</span><span class="p">(</span><span class="nx">vs</span> <span class="p">[]</span><span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span><span class="p">)</span> <span class="p">[]</span><span class="nx">model</span><span class="p">.</span><span class="nx">Constraint</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cs</span> <span class="o">:=</span> <span class="p">[]</span><span class="nx">model</span><span class="p">.</span><span class="nx">Constraint</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">vs</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nx">j</span> <span class="o">:=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">j</span> <span class="p">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nx">vs</span><span class="p">);</span> <span class="nx">j</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cs</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">cs</span><span class="p">,</span> <span class="nx">binary</span><span class="p">.</span><span class="nf">NewNotEquals</span><span class="p">(</span><span class="nx">vs</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">vs</span><span class="p">[</span><span class="nx">j</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">cs</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="basic" class="headerLink">
    <a href="#basic" class="header-mark"></a>Basic</h3><p>Rather than defining many binary constraints, we can do a bit better by defining a single constraint that tracks variables with one live value left and disallows assigning that value to any of the other variables.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">allDiffBasic</span> <span class="kd">struct</span> <span class="p">{</span> <span class="nx">vs</span> <span class="p">[]</span><span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">allDiffBasic</span><span class="p">)</span> <span class="nf">Variables</span><span class="p">()</span> <span class="p">[]</span><span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">vs</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">allDiffBasic</span><span class="p">)</span> <span class="nf">Supported</span><span class="p">(</span><span class="nx">supV</span> <span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span><span class="p">,</span> <span class="nx">supVal</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">other</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">a</span><span class="p">.</span><span class="nx">vs</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">supV</span> <span class="o">==</span> <span class="nx">other</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">other</span><span class="p">.</span><span class="nf">LiveLeft</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">other</span><span class="p">.</span><span class="nf">LiveDomain</span><span class="p">().</span><span class="nf">LastLiveValue</span><span class="p">()</span> <span class="o">==</span> <span class="nx">supVal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="sparse" class="headerLink">
    <a href="#sparse" class="header-mark"></a>Sparse</h3><p>This one is a little bit more clever by being incremental and tracking state change - whenever a variable is assigned, we track which value is &ldquo;claimed&rdquo; and disallow other variables from that value, and when a variable is unassigned, we allow other variables to be assigned to that value again. You can see that happening in the <code>Set()</code> and <code>Cleared()</code> methods below, which are part of incremental interface (not shown).</p>
<p>This is very similar in spirit to &ldquo;Basic&rdquo;, but doesn&rsquo;t require explicitly checking every variable whenever we&rsquo;re seeing if the constraint is violated. The reason I call this type of implementation <em>sparse</em> is because it works well when we have many values to choose from. This is the implementation I use for the <a href="https://dawnofthe.dad/crossword" target="_blank" rel="noopener noreferrer">crossword builder</a>, for ensuring words are not repeated - there are very many words in the dictionary to choose from&hellip; but more on this another time.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">allDiffSparse</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vs</span> <span class="p">[]</span><span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span>
</span></span><span class="line"><span class="cl">  <span class="nx">claimedValues</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">bool</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">allDiffSparse</span><span class="p">)</span> <span class="nf">Variables</span><span class="p">()</span> <span class="p">[]</span><span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">vs</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">allDiffSparse</span><span class="p">)</span> <span class="nf">Supported</span><span class="p">(</span><span class="nx">supV</span> <span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span><span class="p">,</span> <span class="nx">supVal</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">!</span><span class="nx">a</span><span class="p">.</span><span class="nx">claimedValues</span><span class="p">[</span><span class="nx">supVal</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">allDiffSparse</span><span class="p">)</span> <span class="nf">Set</span><span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span><span class="p">,</span> <span class="nx">value</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">a</span><span class="p">.</span><span class="nx">claimedValues</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">allDiffSparse</span><span class="p">)</span> <span class="nf">Cleared</span><span class="p">(</span><span class="nx">v</span> <span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span><span class="p">,</span> <span class="nx">prevValue</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">delete</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">claimedValues</span><span class="p">,</span> <span class="nx">prevValue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pigeonhole" class="headerLink">
    <a href="#pigeonhole" class="header-mark"></a>Pigeonhole</h3><p>This implementation is based on the <a href="https://en.wikipedia.org/wiki/Pigeonhole_principle" target="_blank" rel="noopener noreferrer">Pigeonhole principle</a>, which, to quote Wikipedia, <em>states that if n items are put into m containers, with n &gt; m, then at least one container must contain more than one item</em>. In other words, if we ever get to a state where we have fewer values left to choose from than unassigned variables, we know that the <em>all-different</em> constraint cannot be met. For example, this implementation can detect that if we have three variables, each with domain of {1, 2}, no solution is possible. The more naive implementations would not. So while they all will enforce the constraint given a full assignment, this one can detect infeasibility earlier, saving us from pointlessly trying to find a solution when none exist.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">allDiffPigeonHole</span> <span class="kd">struct</span> <span class="p">{</span> <span class="nx">vs</span> <span class="p">[]</span><span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">allDiffPigeonHole</span><span class="p">)</span> <span class="nf">Variables</span><span class="p">()</span> <span class="p">[]</span><span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">vs</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="o">*</span><span class="nx">allDiffPigeonHole</span><span class="p">)</span> <span class="nf">Supported</span><span class="p">(</span><span class="nx">supV</span> <span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span><span class="p">,</span> <span class="nx">supVal</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">otherVals</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="kt">bool</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">other</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">a</span><span class="p">.</span><span class="nx">vs</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">supV</span> <span class="o">==</span> <span class="nx">other</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">continue</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">atLeastOneSupport</span> <span class="o">:=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="nx">other</span><span class="p">.</span><span class="nf">LiveDomain</span><span class="p">().</span><span class="nf">ForEachValue</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">value</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="nx">value</span> <span class="o">!=</span> <span class="nx">supVal</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">otherVals</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="nx">atLeastOneSupport</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">!</span><span class="nx">atLeastOneSupport</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nx">otherVals</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">vs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="bi-partite" class="headerLink">
    <a href="#bi-partite" class="header-mark"></a>Bi-partite</h3><p>This implementation is the most thorough, because it performs a bi-partite match from variables on one side to possible values on the other, and only succeeds when a maximum match exists. In other words, given a partial assignment of values to variables, this constraint will only remain feasible when a possible all-different assignment still exists. An overly simple example to demonstrate that this implementation is more powerful than pigeonhole one is this:</p>
<ul>
<li>A problem with 3 variables: X, Y and Z.</li>
<li>X must be 1, Y must 1, but Z can be either 2 or 3.</li>
<li>Pigeonhole implementation will say there are 3 values and 3 variables, so a solution might exist, but clearly there is no maximal bipartite match as X and Y will be equal, so the more sophisticated bipartite implementation will flag this as an infeasible state.</li>
<li>As a side-note, while pigeonhole wouldn&rsquo;t detect infeasibility in this example, all of the simpler constraints would. So it&rsquo;s not true that pigeonhole is strictly stronger than the simpler implementations, but it is true that the bipartite one is.</li>
</ul>
<p>There&rsquo;s ~250 lines of code for this one, so I won&rsquo;t include that verbatim, but in short this implementation uses Hopcroft-Karp maximum matching algorithm, porting <a href="https://www.geeksforgeeks.org/hopcroft-karp-algorithm-for-maximum-matching-set-2-implementation/" target="_blank" rel="noopener noreferrer">this implementation</a> to Go, and adds incremental state tracking; e.g., by removing edges from the match as variables are assigned. When the constraint is re-evaluated via <code>Supported()</code>, this allows to start from a partial and often mostly complete matching, rather than from scratch.</p>
<h2 id="comparing-performance" class="headerLink">
    <a href="#comparing-performance" class="header-mark"></a>Comparing performance</h2><p>Cool, so we&rsquo;ve got the implementations. We know that ultimately they&rsquo;ll all give us to a valid sudoku, but what is their performance like? Let&rsquo;s look!</p>
<h3 id="the-setup" class="headerLink">
    <a href="#the-setup" class="header-mark"></a>The setup</h3><p>We&rsquo;ll be looking at generalized NxN sudokus, as they are effectively one big glob of variables, one per sudoku cell, and <em>all-different</em> constraints enforcing horizontal, vertical and block uniqueness. We&rsquo;ll search for the first, randomly encountered solution, and to do so we&rsquo;ll be using a solver with randomized variable and value ordering <a href="http://localhost:1313/posts/heuristics/" rel="">heuristics</a> and apply <a href="http://localhost:1313/posts/constraint-propagation/" rel="">forward checking</a> after every assignment. We&rsquo;ll be looking at sudokus of sizes 16x16, 25x25 and 36x36. You can also try most of these <a href="https://dawnofthe.dad/ndoku" target="_blank" rel="noopener noreferrer">online</a>.</p>
<p>We&rsquo;ll cover two basic metrics - time taken by the solver, and the number of steps the solver took, to reach the first solution. End users will typically only care about the time taken, but the number of steps can give us some insights into how our constraints work.</p>
<p>We&rsquo;ll be using Go&rsquo;s benchmarking tests to evaluate performance of these implementations. Here&rsquo;s what this benchmark/test looks like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="cl"><span class="kd">const</span> <span class="nx">timeout</span> <span class="p">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">experiment</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span> <span class="kt">string</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// For my sudokus &#34;size&#34; is the size of a sub-square, so 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// &#34;size = 3&#34; results in a regular 9x9 sudoku, and so on.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">size</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">  <span class="nx">kind</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">AlgoKind</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">experiments</span> <span class="p">=</span> <span class="p">[]</span><span class="nx">experiment</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;basic&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Basic</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;binary&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Binary</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;sparse&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Sparse</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;pigeonhole&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Pigeonhole</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;bipartite&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Bipartite</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;basic-lg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Basic</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;binary-lg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Binary</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;sparse-lg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Sparse</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;pigeonhole-lg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Pigeonhole</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;bipartite-lg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Bipartite</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;basic-vlg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Basic</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;binary-vlg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Binary</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;sparse-vlg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Sparse</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;pigeonhole-vlg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Pigeonhole</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span><span class="nx">name</span><span class="p">:</span> <span class="s">&#34;bipartite-vlg&#34;</span><span class="p">,</span> <span class="nx">size</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="nx">kind</span><span class="p">:</span> <span class="nx">alldiff</span><span class="p">.</span><span class="nx">Bipartite</span><span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">solveSudoku</span><span class="p">(</span><span class="nx">e</span> <span class="nx">experiment</span><span class="p">)</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sudoku</span> <span class="o">:=</span> <span class="nf">GeneralizedSudoku</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">size</span><span class="p">,</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">{},</span> <span class="nx">e</span><span class="p">.</span><span class="nx">kind</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span> <span class="o">:=</span> <span class="nx">search</span><span class="p">.</span><span class="nx">Config</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">VariableHeuristic</span><span class="p">:</span> <span class="nx">search</span><span class="p">.</span><span class="nf">NewDomWDegVariableHeuristic</span><span class="p">(</span><span class="nx">sudoku</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ValueHeuristic</span><span class="p">:</span>    <span class="nx">search</span><span class="p">.</span><span class="nf">NewRandomValueHeuristic</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">UTC</span><span class="p">().</span><span class="nf">UnixNano</span><span class="p">()),</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">s</span><span class="p">,</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">search</span><span class="p">.</span><span class="nf">NewSearch</span><span class="p">(</span><span class="nx">sudoku</span><span class="p">,</span> <span class="nx">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ctx</span><span class="p">,</span> <span class="nx">cancel</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithTimeout</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">(),</span> <span class="nx">timeout</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">defer</span> <span class="nf">cancel</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">solved</span> <span class="p">=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">solved</span><span class="p">,</span> <span class="nx">s</span><span class="p">.</span><span class="nf">Steps</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">BenchmarkSudoku</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">e</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">experiments</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f</span><span class="p">,</span> <span class="nx">_</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">OpenFile</span><span class="p">(</span><span class="s">&#34;benchmarks/&#34;</span><span class="o">+</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="s">&#34;.dat&#34;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nx">O_RDWR</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_CREATE</span><span class="p">|</span><span class="nx">os</span><span class="p">.</span><span class="nx">O_TRUNC</span><span class="p">,</span> <span class="mo">0755</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">w</span> <span class="o">:=</span> <span class="nx">bufio</span><span class="p">.</span><span class="nf">NewWriter</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">b</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">b</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="nx">i</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="p">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">start</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">solved</span><span class="p">,</span> <span class="nx">steps</span> <span class="o">:=</span> <span class="nf">solveSudoku</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">timeTaken</span> <span class="o">:=</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nf">Microseconds</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nx">w</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%v %v %s\n&#34;</span><span class="p">,</span> <span class="nx">timeTaken</span><span class="p">,</span> <span class="nx">steps</span><span class="p">,</span> <span class="nx">strconv</span><span class="p">.</span><span class="nf">FormatBool</span><span class="p">(</span><span class="nx">solved</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="nx">w</span><span class="p">.</span><span class="nf">Flush</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The performance data is then generated via:</p>
<p><code>go test -bench=BenchmarkSudoku -benchtime=500x -run=^# -timeout=24h</code></p>
<p>and plotted with gnuplot. I generated 1000 instances for 16x16, 500 for 25x25, and 200 for 36x36 graphs.</p>
<h3 id="steps-taken" class="headerLink">
    <a href="#steps-taken" class="header-mark"></a>Steps taken</h3><p>We&rsquo;ll look at steps taken first, because there is a clear winner - as one might expect, the most sophisticated bipartite implementation wins hands-down. In fact, if you try it online with lexicographic ordering you&rsquo;ll notice that it rarely needs to backtrack. Even with randomized ordering it backtracks far less than the alternatives.</p>
<p>Here is the performance of the five implementations for 16x16 sudokus (all graphs in this post are <a href="https://en.wikipedia.org/wiki/Cumulative_distribution_function" target="_blank" rel="noopener noreferrer">cumulative distribution functions</a>):</p>
<p><figure><img
        
        loading="lazy"
        src="/plots/cdf-steps.png"
        srcset="/plots/cdf-steps.png, /plots/cdf-steps.png 1.5x, /plots/cdf-steps.png 2x"
        title="16x16 Sudoku - steps taken" ></figure></p>
<p>Bipartite is the fastest, and it is followed closely by pigeonhole. Basic is in third, followed by binary, and with sparse coming in last. These last three don&rsquo;t perform particularly great in terms of steps taken. One interesting bit is that basic takes slightly fewer steps than sparse - I think this is because it is slightly more aggressive at removing values, as it considers all variables with one variable, rather that just assigned variables like sparse does (so it can cover cases where a variable is not assigned yet, but its live domain only has one value left).</p>
<h3 id="runtime" class="headerLink">
    <a href="#runtime" class="header-mark"></a>Runtime</h3><p><figure><img
        
        loading="lazy"
        src="/plots/cdf-time.png"
        srcset="/plots/cdf-time.png, /plots/cdf-time.png 1.5x, /plots/cdf-time.png 2x"
        title="16x16 Sudoku - time taken" ></figure></p>
<p>Pretty different from steps taken, eh? Let&rsquo;s see what&rsquo;s going on here:</p>
<ul>
<li>Sparse, the slowest in terms of number of steps, is performing really well when it comes to time. Why? There are a couple of reasons: the speed of evaluating a given constraint, and the fact that we only have one constraint for each set of 16 cells. It&rsquo;s fast because it incrementally maintains state, and when asked if a value is still viable just checks if it has already been taken. And, unlike binary constraints, where we&rsquo;d have 120 binary constraints to represent all-difference of 16 cells (15 * 16 / 2 = 120), there&rsquo;s only one constraint to check. 16x16 sudokus also appear to be under-constrained, so this fast, simple implementation, does  well.</li>
<li>Basic comes in next. This isn&rsquo;t too surprising given it is similar to sparse, but not incremental, and hence a bit slower, despite taking fewer steps.</li>
<li>Bipartite follows. It&rsquo;s sophisticated, but slower than the simpler implementations above. It <em>is</em> incremental though, which is important in that when the state changes, the re-evaluations are generally quick.</li>
<li>Binary is second to last for most percentiles (and in fact it is the worst at high percentiles). Here, we have the benefits of &ldquo;simple and fast&rdquo; evaluation, but we have more constraints to evaluate, and this ultimately hurts the runtime, despite the simplicity.</li>
<li>Pigeonhole is the slowest of the bunch, and this is primarily/probably because it is not incremental, so every time it is evaluated, it is somewhat expensive to do so.</li>
</ul>
<h3 id="larger-instances" class="headerLink">
    <a href="#larger-instances" class="header-mark"></a>Larger instances</h3><p>Well, our sophisticated implementation didn&rsquo;t exactly kick butt in terms of time on the smaller instances. Let&rsquo;s look at 25x25 sudokus next. Here, the less sophisticated variants start getting rather slow, so to keep things simple I&rsquo;m capping their runtime at 10 minutes. The timeouts aren&rsquo;t too frequent yet:</p>
<ul>
<li>Basic: 6/500 runs timed out.</li>
<li>Binary: 19/500 runs timed out.</li>
<li>Sparse: 4/500 runs timed out.</li>
</ul>
<p><figure><img
        
        loading="lazy"
        src="/plots/cdf-large-steps.png"
        srcset="/plots/cdf-large-steps.png, /plots/cdf-large-steps.png 1.5x, /plots/cdf-large-steps.png 2x"
        title="25x25 Sudoku - steps taken" ></figure></p>
<p>Looking at steps taken, as before, we can see that bipartite implementation is far smarter and takes way fewer steps than others. Pigeonhole is second best, as before. This isn&rsquo;t too surprising, but perhaps what is interesting is how quickly the simpler implementations start to degrade.</p>
<p><figure><img
        
        loading="lazy"
        src="/plots/cdf-large-time.png"
        srcset="/plots/cdf-large-time.png, /plots/cdf-large-time.png 1.5x, /plots/cdf-large-time.png 2x"
        title="25x25 Sudoku - time taken" ></figure></p>
<p>Looking at the runtime reinforces that story - the less sophisticated implementations complete about an order of magnitude faster when they&rsquo;re &ldquo;lucky&rdquo;, but <strong>many</strong> orders of magnitude slower when they are not (say, at 95 percentile). So, while on average a couple of these implementations are competitive, on occasion we can hit particularly bad runs that take many minutes to complete&hellip; and binary, the simplest of them all, clearly is struggling to keep up. In contrast, the bipartite implementation is very steady, with basically all of the runs completing in 1.5 - 2 seconds. Pigeonhole isn&rsquo;t quite as fast as bipartite, but still tends to hold up well against the simpler implementations. The runtime of the top few percentiles does get significantly worse though.</p>
<h3 id="even-larger-instances" class="headerLink">
    <a href="#even-larger-instances" class="header-mark"></a>Even larger instances</h3><p>The even larger, 36x36 set of sudokus, is where we can see the that the simpler approaches start consistently timing out after 10 minutes:</p>
<ul>
<li>Basic: 25/30 runs timed out.</li>
<li>Binary: 28/30 runs timed out.</li>
<li>Sparse: 24/30 runs timed out.</li>
</ul>
<p>These make sense - based on the smaller instances we already noticed that all 3 of these tend to require many more steps, binary suffers from having too many finer-grained constraints to evaluate, basic is non-incremental, and sparse is only a slight improvement over basic. So none of them do well, binary is worse than the other two, while the incrementality of sparse over basic may be slightly helping.</p>
<p>Only bipartite and pigeonhole implementations remain viable, with bipartite continuing to be in the lead:</p>
<p><figure><img
        
        loading="lazy"
        src="/plots/cdf-very-large-steps.png"
        srcset="/plots/cdf-very-large-steps.png, /plots/cdf-very-large-steps.png 1.5x, /plots/cdf-very-large-steps.png 2x"
        title="36x36 Sudoku - steps taken" ></figure></p>
<p><figure><img
        
        loading="lazy"
        src="/plots/cdf-very-large-time.png"
        srcset="/plots/cdf-very-large-time.png, /plots/cdf-very-large-time.png 1.5x, /plots/cdf-very-large-time.png 2x"
        title="36x36 Sudoku - time taken" ></figure></p>
<p>In short, bipartite is clearly starting to win, and the trend continues for larger instances, based on a handful of ad hoc experiments.</p>
<h2 id="takeaways" class="headerLink">
    <a href="#takeaways" class="header-mark"></a>Takeaways</h2><p>Like with many things, it comes down to trade-offs. In this case, choosing the right implementation of an <em>all-different</em> constraint comes down to choosing between simplicity, speed, and consistent performance. Determining which of these is more important to you can help you choose the right implementation:</p>
<ul>
<li>Fast implementations are easy to understand, and can be &ldquo;good enough&rdquo; for smaller problems, but have unstable run times, and don&rsquo;t scale well.</li>
<li>More sophisticated implementations are the opposite, they&rsquo;re harder to understand and implement, don&rsquo;t provide a ton of value on smaller problems, but truly shine on large problems, and have consistent performance characteristics to boot.</li>
</ul>
<p>Lastly, it&rsquo;s worth noting that more efficient algorithms for <em>all-different</em> constraints and sudokus are out there, and I&rsquo;ve yet to experiment with them. <a href="https://www.ijcai.org/Proceedings/03/Papers/036.pdf" target="_blank" rel="noopener noreferrer">Regin&rsquo;s all-different algorithm</a> and  <a href="https://en.wikipedia.org/wiki/Dancing_Links" target="_blank" rel="noopener noreferrer">Knuth&rsquo;s Dancing links algorithm</a> are two examples of these, respectively.</p>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-11-12</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line print:!tw-hidden">
            <div class="post-info-md"></div>
            <div class="post-info-share"></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg>&nbsp;<a href="/tags/algorithms/">Algorithms</a>,&nbsp;<a href="/tags/go/">Go</a></section>
        <section class="print:!tw-hidden">
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav print:tw-hidden"><a href="/posts/rubber-duck-ftw/" class="prev" rel="prev" title="Rubber Duck FTW"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"/></svg>Rubber Duck FTW</a>
            <a href="/posts/testing/" class="next" rel="next" title="Testing">Testing<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.124.1">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg> DoIt</a>
                </div><div class="footer-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 448c-110.532 0-200-89.451-200-200 0-110.531 89.451-200 200-200 110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200zm107.351-101.064c-9.614 9.712-45.53 41.396-104.065 41.396-82.43 0-140.484-61.425-140.484-141.567 0-79.152 60.275-139.401 139.762-139.401 55.531 0 88.738 26.62 97.593 34.779a11.965 11.965 0 0 1 1.936 15.322l-18.155 28.113c-3.841 5.95-11.966 7.282-17.499 2.921-8.595-6.776-31.814-22.538-61.708-22.538-48.303 0-77.916 35.33-77.916 80.082 0 41.589 26.888 83.692 78.277 83.692 32.657 0 56.843-19.039 65.726-27.225 5.27-4.857 13.596-4.039 17.82 1.738l19.865 27.17a11.947 11.947 0 0 1-1.152 15.518z"/></svg>2024<span class="author">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">Andrei</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons" class="print:!tw-hidden"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"/></svg>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="/lib/katex/katex.min.css"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10000},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script
    src="/lib/clipboard/clipboard.min.js"
    
  ></script><script
    src="/lib/katex/katex.min.js"
    
      defer
    
  ></script><script
    src="/lib/katex/auto-render.min.js"
    
      defer
    
  ></script><script
    src="/js/katex.min.js"
    
      defer
    
  ></script><script
    src="/js/theme.min.js"
    
      defer
    
  ></script></div>
</body>

</html>
