

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" /><title>Building the Crossword Builder - Blog of the Dad</title><meta name="Description" content="Technical website about dawnofthe.dad and the like"><meta property="og:title" content="Building the Crossword Builder" />
<meta property="og:description" content="My crossword builder is essentially composed of two major parts: the frontend and the backend. The frontend is in JavaScript, while the backend is written in Go. In this post I&rsquo;ll talk about how each side works, and how the two communicate with each other." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dawnofthe.dad/posts/building-the-crossword/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-04-08T20:42:30-07:00" />
<meta property="article:modified_time" content="2024-04-08T20:42:30-07:00" /><meta property="og:site_name" content="Blog of the Dad" />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Building the Crossword Builder"/>
<meta name="twitter:description" content="My crossword builder is essentially composed of two major parts: the frontend and the backend. The frontend is in JavaScript, while the backend is written in Go. In this post I&rsquo;ll talk about how each side works, and how the two communicate with each other."/>
<meta name="application-name" content="Blog of the Dad">
<meta name="apple-mobile-web-app-title" content="Blog of the Dad">

<meta name="theme-color" content="#f8f8f8"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

<link rel="canonical" href="https://blog.dawnofthe.dad/posts/building-the-crossword/" /><link rel="prev" href="https://blog.dawnofthe.dad/posts/testing/" />
<link rel="stylesheet" href="/css/main.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">{"@context": "https://schema.org","@type": "BlogPosting",
        "headline": "Building the Crossword Builder",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://blog.dawnofthe.dad/posts/building-the-crossword/"
        },"image": ["https://blog.dawnofthe.dad/xword.png"],"genre": "posts","keywords":["Backend","Frontend","Visualization"],"wordcount":  2822 ,
        "url": "https://blog.dawnofthe.dad/posts/building-the-crossword/","datePublished": "2024-04-08T20:42:30-07:00","dateModified": "2024-04-08T20:42:30-07:00","publisher": {
            "@type": "Organization",
            "name": "Andrei"},"author": {
                "@type": "Person",
                "name": "Andrei",
                "url": "/"
            },"description": ""
    }</script></head>

<body header-desktop="" header-mobile=""><script type="text/javascript">
        function setTheme(theme) {
          document.body.setAttribute('theme', theme); 
          document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');
          if (theme === 'light') {
            document.documentElement.classList.remove('tw-dark')
          } else {
            document.documentElement.classList.add('tw-dark')
          }
          window.theme = theme;   
          window.isDark = window.theme !== 'light' 
        }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('' === 'light' || '' === 'dark' || '' === 'black') setTheme(''), saveTheme(''); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop print:!tw-hidden" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Blog of the Dad"><img
        class="logo"
        loading="lazy"
        src="/android-chrome-192x192.png"
        srcset="/android-chrome-192x192.png, /android-chrome-192x192.png 1.5x, /android-chrome-192x192.png 2x"
        title="/android-chrome-192x192.png" height="36"   width="36" >Blog of the Dad</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item"
                    href="/posts/" > Posts </a><a class="menu-item"
                    href="/tags/" > Tags </a><a class="menu-item"
                    href="/categories/" > Categories </a><span class="menu-item delimiter"></span><button class="menu-item theme-switch" aria-label="Switch Theme">
                    <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
                </button></div>
        </div>
    </div>
</header><header class="mobile print:!tw-hidden" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Blog of the Dad"><img
        class="logo"
        loading="lazy"
        src="/android-chrome-192x192.png"
        srcset="/android-chrome-192x192.png, /android-chrome-192x192.png 1.5x, /android-chrome-192x192.png 2x"
        title="/android-chrome-192x192.png" >Blog of the Dad</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="" >Posts</a><a class="menu-item" href="/tags/" title="" >Tags</a><a class="menu-item" href="/categories/" title="" >Categories</a><button class="menu-item theme-switch tw-w-full" aria-label="Switch Theme">
                <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
            </button></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
            <div class="container"><div class="toc print:!tw-hidden" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#frontend">Frontend</a>
      <ul>
        <li><a href="#state">State</a></li>
      </ul>
    </li>
    <li><a href="#backend">Backend</a>
      <ul>
        <li><a href="#basic-csp-structure">Basic CSP structure</a></li>
        <li><a href="#overlap-constraint">Overlap constraint</a></li>
      </ul>
    </li>
    <li><a href="#protocol">Protocol</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single print:!tw-w-full print:!tw-max-w-none print:!tw-m-0 print:!tw-p-0"><h1 class="single-title animate__animated animate__flipInX">Building the Crossword Builder</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><img src="https://blog.dawnofthe.dad/drd.jpg" alt="Andrei avatar" class="tw-inline-block tw-max-h-4 tw-rounded-full tw-translate-y-[-2px] tw-mr-1"><a href="/" title="Author" rel=" author" class="author">Andrei</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">category <a href="/categories/constructive-search/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>Constructive Search</a></span></div>
            <div class="post-meta-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;<time datetime="2024-04-08">2024-04-08</time>&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;2822 words&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;14 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        
        loading="eager"
        src="/xword.png"
        srcset="/xword.png, /xword.png 1.5x, /xword.png 2x"
        title="/xword.png" ></div><div class="details toc print:!tw-block" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#frontend">Frontend</a>
      <ul>
        <li><a href="#state">State</a></li>
      </ul>
    </li>
    <li><a href="#backend">Backend</a>
      <ul>
        <li><a href="#basic-csp-structure">Basic CSP structure</a></li>
        <li><a href="#overlap-constraint">Overlap constraint</a></li>
      </ul>
    </li>
    <li><a href="#protocol">Protocol</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>My <a href="https://dawnofthe.dad/crossword" target="_blank" rel="noopener noreferrer">crossword builder</a> is essentially composed of two major parts: the frontend and the backend. The frontend is in JavaScript, while the backend is written in Go. In this post I&rsquo;ll talk about how each side works, and how the two communicate with each other.</p>
<h2 id="overview" class="headerLink">
    <a href="#overview" class="header-mark"></a>Overview</h2><p>The high level view of the system is fairly straight-forward, with the user interacting with the frontend via the browser, and the frontend, running in the browser, interacting with the backend over a websocket. The overall flow is basically the same as for the <a href="https://dawnofthe.dad/sudoku" target="_blank" rel="noopener noreferrer">sudoku solver</a>, which I have covered in an <a href="https://blog.dawnofthe.dad/posts/visualizing-search/" rel="">earlier post</a>:
<pre class="mermaid">
sequenceDiagram
    participant User
    participant Browser
    participant Backend
    User->>Browser: Presses "Auto-fill" button
    Browser->>Backend: Start solving
    loop Solving
        Backend->>Browser: State updates every 100ms until solved
    end
    note over Browser,Backend: Communicate over a websocket

</pre></p>
<p><strong>The frontend</strong> is written in TypeScript, and is where all the smarts live for building a crossword grid, seeding it with a few words and all kinds of user-facing validation. The frontend takes care of tracking state via URL parameters, including the requisite encoding and decoding. More on these later.</p>
<p><strong>The backend</strong> is where all the combinatorial optimization happens, to solve a given crossword puzzle. The backend expects the frontend to provide a valid grid, possibly pre-filled with some words; its task is then to find how to fill this grid in, all the way. Since this search for a valid solution to the crossword may take a while, I thought it would be interesting to present in-progress state back to the caller, as search goes on. Websockets are used to pass this data back to the frontend.</p>
<p>Before getting into the details I&rsquo;ll first mention a few self-imposed requirements on the overall system:</p>
<ul>
<li>It&rsquo;s a hobby project of mine, and while I find writing the code for this therapeutic (as in &ldquo;I don&rsquo;t have time to write code for work anymore and this is my outlet&rdquo;), I want to push the limits of what I can do within freebie limits of Google Cloud. So I needed to keep this computationally tractable for the E2 micro VM, and avoid excessive storage and network traffic.</li>
<li>In part for the same reason, and in part to avoid losing data, I want to keep the backend stateless.</li>
<li>I want to make it easy to share the crossword puzzles.</li>
<li>While I do want to optimize things where it is sensible to, I don&rsquo;t want to sacrifice too much just for the sake of speed. Particularly, I want the code for the most complex part of the project be in Go, rather than see how far I can stretch things with TypeScript. I just don&rsquo;t love TypeScript and its tool chain enough&hellip;</li>
</ul>
<h2 id="frontend" class="headerLink">
    <a href="#frontend" class="header-mark"></a>Frontend</h2><p>The frontend has a few key responsibilities, which line up with the steps you might&rsquo;ve seen on the UI:</p>
<ul>
<li><strong>Setting up the grid.</strong> The current version breaks this up into two parts: picking a starting grid from one of the presets, and modifying it to your heart&rsquo;s content. As the grid is filled the relevant info is updated, like the word labels on the grid, and the word stats. These can be useful, as crossword publishers often have requirements about how many words a puzzle should have.</li>
<li><strong>Filling the grid.</strong> This step can also be viewed as two separate kinds of actions: letting the user add their own words to the grid, and letting the user auto-fill the grid for the rest. Importantly, this auto-fill step is the only step where backend interaction happens, as the rest is all done on the frontend.</li>
<li><strong>Filling the clues and printing/saving</strong>. This is the last step where the user can take their fully filled in grid and associate each of the words with clues. The user can then print or save their creation to a PDF file.</li>
</ul>
<p>The above are achieved as follows:</p>
<ul>
<li>A good old <code>canvas</code> is used as the main UI surface, with basic listeners for key / mouse / tap events.</li>
<li>The UI behaves differently depending on which step the user is on, to name a couple of key behaviors:
<ul>
<li>When &ldquo;Edit the grid&rdquo; is selected, clicking on the grid will toggle that cell as a fillable / blocked cell, followed by triggering grid validation</li>
<li>When &ldquo;Fill in words&rdquo; is selected, clicking on the grid will allow the user to start populating the grid with letters + words, which also triggers validation. This time though, validation applies to words rather than the grid itself, as incomplete words are disallowed</li>
</ul>
</li>
<li>On the code level this is achieved by having a few key objects to represent the grid itself, words, clues, and so on. Most of the interactions, primarily from the <code>canvas</code>, are delegated to the relevant objects.</li>
</ul>
<p>One interesting bit here is that I initially tried to flesh all of this out in pure JavaScript, but as the complexity grew, I ended up biting the bullet and moving this logic over to TypeScript. That was the right choice as it allowed me to properly cover key functionality with tests, as well as cleanly separate what was becoming an entangled mess of JavaScript code. I&rsquo;m not an expert in either JavaScript or TypeScript though, so I won&rsquo;t claim that this was the only way to solve that problem, it&rsquo;s just one that worked for me.</p>
<p>As mentioned above, the &ldquo;Auto-fill&rdquo; button on the UI is the one that triggers the actual combinatorial solving on the backend. I&rsquo;ll talk about the protocol between the frontend and the backend separately. For now, let&rsquo;s touch on how state is kept, as this also impacts how state is shared with the backend.</p>
<h3 id="state" class="headerLink">
    <a href="#state" class="header-mark"></a>State</h3><p>State is primarily a frontend concern in my design, as the backend is stateless. As I mentioned earlier, one of my self-imposed requirements is to make that the generated puzzles could be sharable, and one way to achieve this, and tracking state, is just to cram the state into URL parameters, which is exactly what I&rsquo;ve done:</p>
<ul>
<li><code>grid</code> encodes the blank / blocked squares. The puzzle assumes a certain <code>size</code> (which you can override on UI, but backend will reject puzzles larger than 15x15) that together with <code>grid</code> tell the UI what the empty puzzle is. I used a basic binary representation for <code>grid</code> where each square corresponds to a bit, and the entire thing is converted to a base-64 string. This results in a fairly compact way to represent empty grids. Here&rsquo;s the code (the corresponding translation in the opposite direction is similar and is omitted):</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">b64FromTemplate</span><span class="p">(</span><span class="nx">t</span>: <span class="kt">Template</span><span class="p">)</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">bi</span> <span class="o">=</span> <span class="nx">BigInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">t</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">bi</span> <span class="o">=</span> <span class="nx">bi</span> <span class="o">*</span> <span class="nx">bigTwo</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">isBlocked</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">bi</span> <span class="o">=</span> <span class="nx">bi</span> <span class="o">+</span> <span class="nx">bigOne</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">bnToB64</span><span class="p">(</span><span class="nx">bi</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>state</code> encodes the words supplied by the user. Here, I didn&rsquo;t bother optimizing for terseness, as generally speaking users will only manually enter a few words, and so the format of this one is fairly straight-forward, demonstrated by the relevant chunk of code below:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="nx">getWordsAsStateString</span><span class="p">(</span><span class="nx">fixedWords</span>: <span class="kt">Word</span><span class="p">[])</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">words</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fixedWords</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">word</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">wordName</span> <span class="o">=</span> <span class="nx">zeroPad</span><span class="p">(</span><span class="nx">word</span><span class="p">.</span><span class="nx">num</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">word</span><span class="p">.</span><span class="nx">direction</span> <span class="o">==</span> <span class="nx">across</span> <span class="o">?</span> <span class="s2">&#34;-across&#34;</span> <span class="o">:</span> <span class="s2">&#34;-down&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">wordState</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getWordValue</span><span class="p">(</span><span class="nx">word</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">words</span> <span class="o">+=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">wordName</span><span class="si">}</span><span class="sb">=</span><span class="si">${</span><span class="nx">wordState</span><span class="si">}</span><span class="sb">;`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">words</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>all</code> encodes all of the words, including those generated by auto-filling. This one is a bit more like <code>grid</code> in that it enumerates all the blank (i.e., non-blocked) grid cells and for each blank cell tucks on the new letter on a base-26 big-int, which is converted to a base-64 string:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="nx">getAsB64</span><span class="p">()</span><span class="o">:</span> <span class="kt">string</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">size</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">blanks</span><span class="p">.</span><span class="nx">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">bi</span> <span class="o">=</span> <span class="nx">BigInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="o">&lt;</span> <span class="nx">size</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Point</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">blanks</span><span class="p">.</span><span class="nx">isBlocked</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">bi</span> <span class="o">=</span> <span class="nx">bi</span> <span class="o">*</span> <span class="nx">bigTwentySix</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">bi</span> <span class="o">=</span> <span class="nx">bi</span> <span class="o">+</span> <span class="nx">BigInt</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="kr">get</span><span class="p">(</span><span class="nx">p</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="nx">aOffest</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">bnToB64</span><span class="p">(</span><span class="nx">bi</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>These allow me to track state without storing it anywhere other than URL parameters. Here&rsquo;s an <a href="https://dawnofthe.dad/crossword?grid=EEAggEEAAhxEQRAIABEQACARBERwgAEEAggEEA%3D%3D&amp;state=45-across%3Dcat%3B&amp;all=DORCclsKasQYWMBlkEo7oGe8WOSuQFzlTk8S1tiLJygm9lO3fAfQ%2FT0Cbscm%2BxDiDr%2FUT0%2F1FMbK2%2BaZvanxeqSbDuV8Cs8ctRv77LUQn65egAOyuupibwFnpSFVlMSf9oSq4BW2dmwvGlsgwJuo" target="_blank" rel="noopener noreferrer">example</a>. Breaking this down into pieces:</p>
<ul>
<li><code>grid</code> is set to <code>EEAggEEAAhxEQRAIABEQACARBERwgAEEAggEEA%3D%3D</code>, encoding the blank / blocked cells,</li>
<li><code>state</code> is set to <code>45-across%3Dcat%3B</code> (45 across is &ldquo;cat&rdquo;),</li>
<li><code>all</code> is the rather beefy string encoding the rest of the grid (snippet included, see URL for the full thing): <code>DORCclsKasQYWMBlkEo7oGe8WOSuQFzlTk8S1tiL...</code></li>
</ul>
<p>The above results in the following crossword: <figure><img
        
        loading="lazy"
        src="/sample-crossword.png"
        srcset="/sample-crossword.png, /sample-crossword.png 1.5x, /sample-crossword.png 2x"
        title="Crossword example" ></figure></p>
<blockquote>
<p><strong>Note</strong>: clues are not stored <em>yet</em>. These will be even more beefy than <code>all</code>, so I&rsquo;m entertaining the idea of compressing them before putting them into URL parameters, or looking for other means to store puzzle state. For now, one can &ldquo;Save&rdquo; or print the puzzle and its clues.</p>
</blockquote>
<h2 id="backend" class="headerLink">
    <a href="#backend" class="header-mark"></a>Backend</h2><p>At the most basic level, the backend has <strong>one</strong> responsibility<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> - auto-fill the puzzles provided by the frontend. A bit more specifically, the frontend will specify the following:</p>
<ul>
<li><code>grid</code>, as described above,</li>
<li><code>size</code>, which defaults to 15 (and 15 is the maximum allowed),</li>
<li><code>longer</code>, which is a boolean that allows the user to pick the longer word list,</li>
<li><code>state</code>, as described above (may be empty).</li>
</ul>
<p>The backend will accept these, do its own validation (like rejecting instances where <code>size &gt; 15</code>, so that my poor E2 micro VM instance doesn&rsquo;t blow up), model the crossword as a constraint satisfaction problem (CSP) and then stream search progress over the websocket back to the frontend. Let&rsquo;s take a look at how this CSP is constructed.</p>
<h3 id="basic-csp-structure" class="headerLink">
    <a href="#basic-csp-structure" class="header-mark"></a>Basic CSP structure</h3><p>While the UI itself has a bit of complexity of its own, the bulk of complexity lies in the solver that auto-fills the crossword puzzle. To do this, the solver converts the inputs above into a CSP:</p>
<ul>
<li><strong>Variables</strong> - in this case, we will associate each crossword entry, like 5-across, with a variable.</li>
<li><strong>Variable domains</strong> of such variables are the possible words from the dictionary that such a crossword entry can take. Here the word length is the only thing that matters, so if the crossword entry is 5 letters long, the domain of its variable is all dictionary words of length 5.</li>
<li><strong>Constraints</strong> - there are two key types of constraints in a crossword:
<ul>
<li><strong>All different constraint</strong> states that we will only use a given word from the dictionary at most once. We&rsquo;ll only need one for the entire puzzle, but if you want to get to the nitty-gritty level, it&rsquo;s a bit more efficient to have one all-different constraint per possible word length.</li>
<li><strong>Overlap constraints</strong> state that overlapping words (across and down) must have the same letter in the cell that they overlap on. For example, in the filled crossword above we can see that 1-across is &ldquo;ABAC&rdquo; and 1-down is &ldquo;ATAT&rdquo; - the two words overlap on the first letter, which happens to be &ldquo;A&rdquo;.  There will be many constraints of this type, to enumerate all overlaps.</li>
</ul>
</li>
</ul>
<p>As always, the goal of solving a CSP is to find an assignment to all variables such that none of the constraints are violated. In our case this means choosing words to assign to each of the crossword entries, and the constraints will ensure that no overlapping words disagree, and each word is used at most once.</p>
<p>The idea is then that the user will specify:</p>
<ul>
<li><code>grid</code> and <code>size</code> to define the overall puzzle structure and thus the variables,</li>
<li><code>longer</code> to tell us which dictionary to use, which will inform the variables&rsquo; domains,</li>
<li><code>state</code> to lock a few of the variables in to the values that the user provided (we won&rsquo;t check if these belong to the dictionary and take them for granted).</li>
</ul>
<p>The trickiest bit is making this efficient, because solving a CSP may mean visiting millions of states, and so we need to ensure that constraint evaluation is quick. I&rsquo;ve <a href="https://blog.dawnofthe.dad/posts/all-different-variants/" rel="">written</a> at some length about <strong>all-different constraints</strong> and its different implementations, so here I&rsquo;ll just mention that the <code>Sparse</code> implementation tends to be the best fit for crosswords, because it is fast to evaluate and works well when there are few variables with large domains, which is exactly the case for crossword puzzles. The <strong>overlap constraint</strong> is more interesting here, in that, unlike all-different constraint which is generic, this one is special-purpose. So let&rsquo;s dig into this one.</p>
<h3 id="overlap-constraint" class="headerLink">
    <a href="#overlap-constraint" class="header-mark"></a>Overlap constraint</h3><p>An overlap constraint will apply to a specific overlap between a pair of words, and its structure is basically this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">overlapConstraint</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Variables for crossword entries.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">firstVar</span><span class="p">,</span> <span class="nx">secondVar</span> <span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// These store basic info (X, Y, Number, Length) about the crossword entries.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">firstWord</span><span class="p">,</span> <span class="nx">secondWord</span> <span class="nx">Word</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 0-based letter offset into the respective words.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">firstOverlapOffset</span><span class="p">,</span> <span class="nx">secondOverlapOffset</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Dictionary.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">words</span> <span class="o">*</span><span class="nx">Words</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The key bit to making this constraint efficient is being able to determine whether this constraint supports the assignment of a new value to one of its variables. In my model this means implementing the following (a few details are omitted for brevity):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">oc</span> <span class="o">*</span><span class="nx">overlapConstraint</span><span class="p">)</span> <span class="nf">Supported</span><span class="p">(</span><span class="nx">supV</span> <span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span><span class="p">,</span> <span class="nx">supVal</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Grab relevant info for the other variable.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">otherV</span> <span class="o">:=</span> <span class="nx">oc</span><span class="p">.</span><span class="nx">firstVar</span>
</span></span><span class="line"><span class="cl">	<span class="nx">otherOffset</span> <span class="o">:=</span> <span class="nx">oc</span><span class="p">.</span><span class="nx">firstOverlapOffset</span>
</span></span><span class="line"><span class="cl">	<span class="nx">otherLength</span> <span class="o">:=</span> <span class="nx">oc</span><span class="p">.</span><span class="nx">firstWord</span><span class="p">.</span><span class="nx">Length</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="nx">supV</span> <span class="o">==</span> <span class="nx">oc</span><span class="p">.</span><span class="nx">firstVar</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="nx">otherV</span> <span class="p">=</span> <span class="nx">oc</span><span class="p">.</span><span class="nx">secondVar</span>
</span></span><span class="line"><span class="cl">		<span class="nx">otherOffset</span> <span class="p">=</span> <span class="nx">oc</span><span class="p">.</span><span class="nx">secondOverlapOffset</span>
</span></span><span class="line"><span class="cl">		<span class="nx">otherLength</span> <span class="p">=</span> <span class="nx">oc</span><span class="p">.</span><span class="nx">secondWord</span><span class="p">.</span><span class="nx">Length</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Find the actual character on which the two words/entries overlap.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">supChar</span> <span class="o">:=</span> <span class="nx">oc</span><span class="p">.</span><span class="nf">overlappingCharacter</span><span class="p">(</span><span class="nx">supV</span><span class="p">,</span> <span class="nx">supVal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Now see if any of the words in the other variable&#39;s live domain have a word
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// with that character in the overlapping cell.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="nx">possibleWordValues</span> <span class="o">:=</span> <span class="nx">oc</span><span class="p">.</span><span class="nx">words</span><span class="p">.</span><span class="nf">MatchingWords</span><span class="p">(</span><span class="nx">otherLength</span><span class="p">,</span> <span class="nx">otherOffset</span><span class="p">,</span> <span class="nx">supChar</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">supported</span> <span class="o">:=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">	<span class="nx">otherV</span><span class="p">.</span><span class="nf">LiveDomain</span><span class="p">().</span><span class="nf">ForEachValue</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">value</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="nx">possibleWordValues</span><span class="p">[</span><span class="nx">value</span><span class="p">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">supported</span> <span class="p">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">	<span class="p">})</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">supported</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>That&rsquo;s somewhat dense, so a few clarifications are in order:</p>
<ul>
<li><code>supV</code> and <code>supVal</code> refer to the variable and value that were just assigned by search,</li>
<li><code>otherV</code> and the rest of <code>other*</code> refer to the <em>other</em> variable in scope of this constraint,</li>
<li><code>oc.words.MatchingWords()</code> returns a precomputed list of words that are of length <code>otherLength</code>, and have <code>supChar</code> appearing at <code>otherOffset</code>,</li>
<li>The idea is then that as we assign <code>supV</code> we want to make sure that <code>otherV</code> has at least one value (word from the dictionary) that it can still choose. If it does not, the search will need to try something else.</li>
</ul>
<blockquote>
<p><strong>Note</strong>: <code>MatchingWords</code> generates all possible lists once, when the problem is constructed. This results in a larger memory footprint and some up-front cost to generate these lists, but makes the evaluation of <code>Supported</code> function above quicker.</p>
</blockquote>
<p>And now that we&rsquo;ve defined all the variables, their domains, and all of the constraints, we can rely on the CSP engine to search for a solution. As the search for a solution progresses we will send the latest state back to the frontend via the websocket. With that, let&rsquo;s touch on the protocol between the frontend and the backend.</p>
<h2 id="protocol" class="headerLink">
    <a href="#protocol" class="header-mark"></a>Protocol</h2><p>The protocol between the frontend and the backend is trivial - I push a <code>size x size</code> byte array containing the grid from the backend to the front at a set cadence (100ms). The frontend then does the trivial interpretation and renders it on the UI. Here&rsquo;s the bit of code that generates these messages on the backend:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">CrosswordClient</span><span class="p">)</span> <span class="nf">convertState</span><span class="p">(</span><span class="nx">state</span> <span class="kd">map</span><span class="p">[</span><span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span><span class="p">]</span><span class="kt">int</span><span class="p">)</span> <span class="p">[]</span><span class="kt">byte</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nx">grid</span> <span class="o">:=</span> <span class="nx">problem</span><span class="p">.</span><span class="nf">CrosswordStateToGrid</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">crossword</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">words</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">problem</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="nx">r</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">crossword</span><span class="p">.</span><span class="nx">Size</span><span class="o">*</span><span class="nx">c</span><span class="p">.</span><span class="nx">crossword</span><span class="p">.</span><span class="nx">Size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="nx">x</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">x</span> <span class="p">&lt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">crossword</span><span class="p">.</span><span class="nx">Size</span><span class="p">;</span> <span class="nx">x</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="nx">y</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">y</span> <span class="p">&lt;</span> <span class="nx">c</span><span class="p">.</span><span class="nx">crossword</span><span class="p">.</span><span class="nx">Size</span><span class="p">;</span> <span class="nx">y</span><span class="o">++</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="nx">idx</span> <span class="o">:=</span> <span class="nx">x</span> <span class="o">+</span> <span class="nx">y</span><span class="o">*</span><span class="nx">c</span><span class="p">.</span><span class="nx">crossword</span><span class="p">.</span><span class="nx">Size</span>
</span></span><span class="line"><span class="cl">			<span class="nx">r</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="p">=</span> <span class="nx">grid</span><span class="p">[</span><span class="nx">x</span><span class="p">][</span><span class="nx">y</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="nx">r</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above is computationally cheap, but uses a bit more bandwidth than a more condensed/compressed solution might. That being said, 15x15=225, so we&rsquo;re looking at only 2.25KB/s, which is small enough not to care.</p>
<h2 id="summary" class="headerLink">
    <a href="#summary" class="header-mark"></a>Summary</h2><p>In this post I&rsquo;ve described how I&rsquo;ve bolted together a frontend and a backend to create the crossword builder, along with they requirements and responsibilities that I&rsquo;ve assigned to each, and the basic protocol between the two. I&rsquo;ve spoken at some length about what the frontend is like, and in a bit of detail about how the backend solves these problems by modeling them as CSPs. If you&rsquo;re interested in learning more about the CSP solver itself, check out my other <a href="https://blog.dawnofthe.dad/categories/constructive-search/" rel="">posts on the subject</a>.</p>
<p>This post ended up rather long, so I&rsquo;ve left out a few important, but separable things, relating to the backend and keeping it reliable, plus a few tidbits about how the site is deployed. I might write more about those another time, and, if you&rsquo;ve made it this far, thanks for reading!</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>This is a slight lie, in reality the backend is also responsible for hosting the website itself.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2024-04-08</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line print:!tw-hidden">
            <div class="post-info-md"></div>
            <div class="post-info-share"></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg>&nbsp;<a href="/tags/backend/">Backend</a>,&nbsp;<a href="/tags/frontend/">Frontend</a>,&nbsp;<a href="/tags/visualization/">Visualization</a></section>
        <section class="print:!tw-hidden">
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav print:tw-hidden"><a href="/posts/testing/" class="prev" rel="prev" title="Testing"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"/></svg>Testing</a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.124.1">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg> DoIt</a>
                </div><div class="footer-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 448c-110.532 0-200-89.451-200-200 0-110.531 89.451-200 200-200 110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200zm107.351-101.064c-9.614 9.712-45.53 41.396-104.065 41.396-82.43 0-140.484-61.425-140.484-141.567 0-79.152 60.275-139.401 139.762-139.401 55.531 0 88.738 26.62 97.593 34.779a11.965 11.965 0 0 1 1.936 15.322l-18.155 28.113c-3.841 5.95-11.966 7.282-17.499 2.921-8.595-6.776-31.814-22.538-61.708-22.538-48.303 0-77.916 35.33-77.916 80.082 0 41.589 26.888 83.692 78.277 83.692 32.657 0 56.843-19.039 65.726-27.225 5.27-4.857 13.596-4.039 17.82 1.738l19.865 27.17a11.947 11.947 0 0 1-1.152 15.518z"/></svg>2024<span class="author">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">Andrei</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons" class="print:!tw-hidden"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"/></svg>
        </a>
    </div><script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true, theme: (window.theme === 'dark' ? 'dark' : 'default') });
</script><div class="assets"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10000},"comment":{}};</script><script
    src="/lib/clipboard/clipboard.min.js"
    
  ></script><script
    src="/js/theme.min.js"
    
      defer
    
  ></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-WS2FCBYJLF');
        </script><script
    src="https://www.googletagmanager.com/gtag/js?id=G-WS2FCBYJLF"
    async
  ></script></div>
</body>

</html>
