<!doctype html><html lang=en-us><head><title>Rubber Duck FTW - Blog of the Dad</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=" Blog of the Dad"><meta name=author content="Andrei"><meta property="og:title" content="Rubber Duck FTW"><meta property="og:description" content="Rubber duck technique for improving your code and design"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.dawnofthe.dad/posts/rubber-duck-ftw/"><meta property="og:image" content="https://blog.dawnofthe.dad/duck.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-21T22:16:25-07:00"><meta property="article:modified_time" content="2023-09-21T22:16:25-07:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.dawnofthe.dad/duck.jpg"><meta name=twitter:title content="Rubber Duck FTW"><meta name=twitter:description content="Rubber duck technique for improving your code and design"><meta name=generator content="Hugo 0.117.0"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=/android-chrome-192x192.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=apple-mobile-web-app-title content="Blog of the Dad"><meta name=application-name content="Blog of the Dad"><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-TileImage content="/mstile-144x144.png"><meta name=theme-color content="#ffffff"><script src=/js/mathjax-config.js defer></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin=anonymous><link rel=stylesheet href=https://blog.dawnofthe.dad/fontawesome/css/all.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda"><link rel=stylesheet type=text/css href=/css/styles.css></head><body><div id=container><header><h1><a href=/>Blog of the Dad</a></h1><ul id=social-media><li><a href=https://twitter.com/userundefinedrd title=Twitter><i class="fab fa-twitter fa-lg"></i></a></li><li><a href=https://reddit.com/u/userundefined title=Reddit><i class="fab fa-reddit-alien fa-lg"></i></a></li></ul><p><em>Donâ€™t eat me. I have a wife and kids. Eat them.</em></p></header><nav><ul></ul></nav><main><article><h1>Rubber Duck FTW</h1><aside><ul><li><time class=post-date datetime=2023-09-21T22:16:25-07:00>Sep 21, 2023</time></li><li><em><a href=/tags/code-and-design>#Code and design</a></em></li><li>7 minute read</li></ul></aside><div class=featured_image><a href=https://blog.dawnofthe.dad/posts/rubber-duck-ftw/ title="Rubber Duck FTW"><img src=/duck.jpg></a></div><p>Rubber duck debugging is a well known debugging technique - it boils down to explaining the code to a rubber duck, whether a real one, or a coworker who unwittingly becomes the &ldquo;rubber duck&rdquo;. Halfway through the explanation the &ldquo;Wait &mldr; what?&rdquo; moment pops up, you know where the bug is and you run off to fix it, potentially leaving your coworker wondering why you just ran off mid-sentence.</p><p>There are plenty of articles that talk about rubber duck debugging in detail, but why should this neat technique be restricted to <em>just debugging</em>? I&rsquo;ll explore one area in particular - applying this technique as a means to <em>improve</em> existing code and design, rather than just for debugging.</p><h2 id=the-mighty-duck>The mighty duck</h2><p>Rubber duck debugging requires you to you walk through your code and explain it step by step, justifying what each bit of code is meant to do and how it is doing it. At some point you end up realizing that what you thought the code <strong>ought to do</strong> and what the code <strong>actually does</strong> don&rsquo;t actually match, and that could be the bug!</p><p>Or maybe you misunderstood something. This may be an opportunity to improve your code, by adding a test, cleaning up a comment, or refactoring your code, so that next time you walk through the code the logic is more self-evident (as a side-note - I&rsquo;m a big fan of <a href=https://en.wikipedia.org/wiki/Self-documenting_code>self-documenting code</a> which significantly reduces the chance that your comments become a lie as your code changes, among other things).</p><p>OK, cool, so that&rsquo;s <em>mostly</em> just good ol&rsquo; rubber duck debugging&mldr; so what? I think that the same approach can be applied more broadly, specifically in the context of improving existing code and designs. The idea is the same as before, you walk through your code / design, explaining what it does and how to your rubber duck of choice, <strong>and through this process you find opportunities to make things better</strong>. I alluded to that in the previous paragraph, where you&rsquo;d be looking for a bug, but may find things along the way that could be improved. However, unlike regular debugging where you basically have to find and fix the bug, pragmatically, when would it be sensible to do such a walk-through?</p><h2 id=applying-to-code-maybe>Applying to code? Maybe</h2><p>The initial inclination may be that this isn&rsquo;t worth the trouble at all, and, for majority of the cases <em>pertaining to code</em>, it&rsquo;s probably right: code is often either good-enough to serve its purpose as is, might be relatively short-lived, or otherwise uninteresting&mldr; but there may be bits of code that are subtle, critical to the correctness / performance, or otherwise important. This type of code can be a great opportunity to step back, explain it to the rubber duck, and see if your argument is as clear and convincing as you thought it was. If it&rsquo;s not, maybe you&rsquo;re not understanding the problem fully yet? Maybe you applied a well-known algorithm, but don&rsquo;t <em>quite</em> follow how it all works, and you have a chance to take a step back, make the code clearer, or more optimized to your use-case? Maybe you can simplify the code? Or maybe you actually <strong>proactively</strong> found a subtle bug that you haven&rsquo;t thought of before, rather than reactively?</p><p>On the other hand, code reviews are an established practice and should catch many flaws, whether they are done by another person, or by yourself as you&rsquo;re checking code in. While this is true, small tweaks that look sensible in isolation can result in correct, but clunky code. Would a more thorough review catch them? Probably. Is doing an extra pass worth the effort? <em>Maybe</em>. You&rsquo;ll want to apply your best judgement here, depending on importance of the code and its cleanliness to your project.</p><h3 id=example>Example</h3><p>This snippet of code is from my solver (with slight simplifications) and resulted as I piled on new features, like logging and the ability to keep track of solution cost:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-golang data-lang=golang><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1</span><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>s</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Search</span>) <span style=color:#a6e22e>Run</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>SolutionWithCost</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2</span><span>  <span style=color:#66d9ef>for</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3</span><span>    <span style=color:#a6e22e>done</span>, <span style=color:#a6e22e>solution</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>step</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4</span><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>done</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5</span><span>      <span style=color:#a6e22e>solved</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>solution</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6</span><span>      <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>logDone</span>(<span style=color:#a6e22e>solved</span>)
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7</span><span>      <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>solved</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8</span><span>        <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>problem</span>.<span style=color:#a6e22e>SolutionFound</span>()
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10</span><span>      <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>solution</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11</span><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>SolutionWithCost</span>{
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12</span><span>          <span style=color:#a6e22e>Solution</span>: <span style=color:#a6e22e>solution</span>,
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13</span><span>          <span style=color:#a6e22e>Cost</span>: <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>problem</span>.<span style=color:#a6e22e>CurrentCost</span>()}
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14</span><span>      }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15</span><span>      <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16</span><span>    }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17</span><span>  }
</span></span><span style=display:flex><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18</span><span>}
</span></span></code></pre></div><p>While this code is fairly straight-forward, it can be cleaned up by merging the two if-statements on lines 7 and 10. This doesn&rsquo;t functionally change anything, but cleans things up and removes confusion because the two if-statement branches really <strong>are</strong> equivalent, even though at a glance that&rsquo;s not immediately obvious.</p><h2 id=ducks-and-docs>Ducks and docs</h2><p>Every once in a while you&rsquo;re likely to end up writing some kind of a technical document. It might be a README file, a design document explaining what your API does, or, as the case was with the example above, a <a href=https://blog.dawnofthe.dad/posts/search-algo-in-go/>blog post</a>. As you are writing such a doc you&rsquo;ll likely find yourself inadvertently following similar steps to the rubber duck technique - you&rsquo;ll be explaining to the readers what your code / API / thing does, and as you are doing this it&rsquo;s a great time to check whether what you are describing is accurate. For example, are the edge-cases of your API behaving as the documentation says they should? Do you have tests to prove that? Or does the complex logic you are describing to the reader actually match what the code does? In either case, and particularly as time passes and the underlying code changes (possibly due to changes made by you <strong>and others</strong>), creating and updating these docs can be a good opportunity to double check that things are still as you intended.</p><p>The other and more important benefit of such an exercise is that not only is it an opportunity to double-check <strong>specific bits</strong>, which you would be looking at anyway as you incrementally build up the codebase, but it is also an opportunity to confirm that <strong>together</strong> all these changes are consistent and easy to understand. You may learn that the API(s) your code exposes, parts of which in isolation look reasonable, have inconsistencies, which could lead to confusion and difficulty using them properly. Or you might find code paths that separately are performant, but combined are not. Or you might discover that complexity of the whole system is getting out of hand and a refactoring or even bigger structural changes are overdue.</p><p>In any event, unlike proactive code reviews, which may be overkill, keeping documentation updated is useful for you and your users, so such doc updates should be done anyway - why not use this as an opportunity to run the doc by your trusty old rubber duck, and see if things could be improved? So the next time you&rsquo;re updating the README, explain it to the rubber duck, too.</p><h3 id=another-example>Another example</h3><p>As I was writing <a href=https://blog.dawnofthe.dad/posts/visualizing-search/>the post about visualizing search</a> and describing the protocol I was forced to poke around a bit harder that I had before, and look at the exact messages being sent over the wire. While I&rsquo;ve previously done a good deal of testing (admittedly, largely manual because integration testing with websockets <em>sounds</em> hard) and the code <em>did work</em>, it turned out it did so in a goofy way - the sudoku data was sent transposed, so the data would describe columns first, and the client would then transpose them back so that on the frontend rows appeared first, instead of columns. Thinking back on this, this rings a bell, I recall being confused, but figuring &ldquo;eh, easy enough to transpose back on the client&rdquo;, pushing the change and &mldr; forgetting about this little bit of mess I&rsquo;ve created. Writing about how it worked made me feel bad enough to go and actually fix it properly.</p><h3 id=and-oldie-but-a-goodie>And oldie, but a goodie</h3><p>Lastly, don&rsquo;t forget about the very relevant code-metric: <a href=https://www.osnews.com/story/19266/wtfsm/>WTF per minute</a>; if you&rsquo;re skimming the code / docs and something looks off, it&rsquo;s a good chance to dig a bit deeper, understand why, and make it less <em>off</em> for the next person who reads that code / doc.</p></article><section class=post-nav><ul><li><a href=https://blog.dawnofthe.dad/posts/visualizing-search/><i class="fa fa-chevron-circle-left"></i> Visualizing Search</a></li><li></li></ul></section></main><footer><ul><li><h6>Rendered by
<a href=https://gohugo.io title=Hugo>Hugo</a> and based on a fork of the <a href=https://themes.gohugo.io/themes/hugo-kiera/>Kiera theme</a> |
<link href=/feed.xml type=application/atom+xml rel=alternate title="Blog of the Dad"><a href=https://blog.dawnofthe.dad/index.xml>Subscribe</a></h6></li></ul></footer></div><script src=/js/scripts.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WS2FCBYJLF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-WS2FCBYJLF",{anonymize_ip:!1})}</script></body></html>