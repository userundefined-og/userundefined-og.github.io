

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" /><title>Search Algo in Go - Blog of the Dad</title><meta name="Description" content="Solving CSPs: search tree and the code skeleton for the solver"><meta property="og:title" content="Search Algo in Go" />
<meta property="og:description" content="Solving CSPs: search tree and the code skeleton for the solver" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dawnofthe.dad/posts/search-algo-in-go/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-03T10:24:10-07:00" />
<meta property="article:modified_time" content="2023-09-03T10:24:10-07:00" /><meta property="og:site_name" content="Blog of the Dad" />
<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Search Algo in Go"/>
<meta name="twitter:description" content="Solving CSPs: search tree and the code skeleton for the solver"/>
<meta name="application-name" content="Blog of the Dad">
<meta name="apple-mobile-web-app-title" content="Blog of the Dad">

<meta name="theme-color" content="#f8f8f8"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

<link rel="canonical" href="https://blog.dawnofthe.dad/posts/search-algo-in-go/" /><link rel="prev" href="https://blog.dawnofthe.dad/posts/solver-basics/" /><link rel="next" href="https://blog.dawnofthe.dad/posts/constraint-propagation/" />
<link rel="stylesheet" href="/css/main.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/animate/animate.min.css">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">{"@context": "https://schema.org","@type": "BlogPosting",
        "headline": "Search Algo in Go",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://blog.dawnofthe.dad/posts/search-algo-in-go/"
        },"genre": "posts","keywords":["Algorithms","Go"],"wordcount":  1025 ,
        "url": "https://blog.dawnofthe.dad/posts/search-algo-in-go/","datePublished": "2023-09-03T10:24:10-07:00","dateModified": "2023-09-03T10:24:10-07:00","publisher": {
            "@type": "Organization",
            "name": "Andrei"},"author": {
                "@type": "Person",
                "name": "Andrei",
                "url": "/"
            },"description": "Solving CSPs: search tree and the code skeleton for the solver"
    }</script></head>

<body header-desktop="" header-mobile=""><script type="text/javascript">
        function setTheme(theme) {
          document.body.setAttribute('theme', theme); 
          document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');
          if (theme === 'light') {
            document.documentElement.classList.remove('tw-dark')
          } else {
            document.documentElement.classList.add('tw-dark')
          }
          window.theme = theme;   
          window.isDark = window.theme !== 'light' 
        }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('' === 'light' || '' === 'dark' || '' === 'black') setTheme(''), saveTheme(''); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop print:!tw-hidden" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Blog of the Dad"><img
        class="logo"
        loading="lazy"
        src="/android-chrome-192x192.png"
        srcset="/android-chrome-192x192.png, /android-chrome-192x192.png 1.5x, /android-chrome-192x192.png 2x"
        title="/android-chrome-192x192.png" height="36"   width="36" >Blog of the Dad</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item"
                    href="/posts/" > Posts </a><a class="menu-item"
                    href="/tags/" > Tags </a><a class="menu-item"
                    href="/categories/" > Categories </a><span class="menu-item delimiter"></span><button class="menu-item theme-switch" aria-label="Switch Theme">
                    <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
                </button></div>
        </div>
    </div>
</header><header class="mobile print:!tw-hidden" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Blog of the Dad"><img
        class="logo"
        loading="lazy"
        src="/android-chrome-192x192.png"
        srcset="/android-chrome-192x192.png, /android-chrome-192x192.png 1.5x, /android-chrome-192x192.png 2x"
        title="/android-chrome-192x192.png" >Blog of the Dad</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="" >Posts</a><a class="menu-item" href="/tags/" title="" >Tags</a><a class="menu-item" href="/categories/" title="" >Categories</a><button class="menu-item theme-switch tw-w-full" aria-label="Switch Theme">
                <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
            </button></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="main">
            <div class="container"><div class="toc print:!tw-hidden" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#nodes-in-the-search-tree">Nodes in the search tree</a></li>
    <li><a href="#building-the-search-tree">Building the search tree</a></li>
  </ul>
</nav></div>
    </div><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single print:!tw-w-full print:!tw-max-w-none print:!tw-m-0 print:!tw-p-0"><h1 class="single-title animate__animated animate__flipInX">Search Algo in Go</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><img src="https://blog.dawnofthe.dad/drd.jpg" alt="Andrei avatar" class="tw-inline-block tw-max-h-4 tw-rounded-full tw-translate-y-[-2px] tw-mr-1"><a href="/" title="Author" rel=" author" class="author">Andrei</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">category <a href="/categories/constructive-search/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>Constructive Search</a></span></div>
            <div class="post-meta-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;<time datetime="2023-09-03">2023-09-03</time>&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;1025 words&nbsp;<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;5 minutes&nbsp;</div>
        </div><div class="details toc print:!tw-block" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#nodes-in-the-search-tree">Nodes in the search tree</a></li>
    <li><a href="#building-the-search-tree">Building the search tree</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>My previous couple of posts talked about <a href="https://blog.dawnofthe.dad/posts/solver-intro/" rel="">what the solver does (solves CSPs)</a>, <a href="https://blog.dawnofthe.dad/posts/solver-basics/" rel="">how to model a problem as a CSP, and how the search tree is built</a> as the solver searches for a solution. In this post I will expand on the details of search by outlining the key data structures and bits of code. The backend is written in <a href="https://go.dev" target="_blank" rel="noopener noreferrer">Go lang</a>, and so are all of the code snippets here.</p>
<h2 id="nodes-in-the-search-tree" class="headerLink">
    <a href="#nodes-in-the-search-tree" class="header-mark"></a>Nodes in the search tree</h2><p>We&rsquo;ll be building a search tree, which is composed of nodes. We&rsquo;ll also need to track a couple of things as we build the search tree. Here they are:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">type</span> <span class="nx">nodeState</span> <span class="kt">int</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="kd">const</span> <span class="p">(</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nx">freshNode</span> <span class="nx">nodeState</span> <span class="p">=</span> <span class="kc">iota</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">  <span class="nx">solutionFound</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">  <span class="nx">assignmentTried</span>
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">  <span class="nx">unassignmentTried</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">
</span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="kd">type</span> <span class="nx">decision</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">  <span class="nx">variable</span> <span class="o">*</span><span class="nx">model</span><span class="p">.</span><span class="nx">Variable</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">  <span class="nx">value</span>    <span class="kt">int</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="c1">// When valueAssigned is true variable = value, else variable != value.
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="c1"></span>  <span class="nx">valueAssigned</span> <span class="kt">bool</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">15</span><span class="cl">
</span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="kd">type</span> <span class="nx">node</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="nx">parent</span>      <span class="o">*</span><span class="nx">node</span> <span class="c1">// nil at root
</span></span></span><span class="line"><span class="ln">18</span><span class="cl"><span class="c1"></span>  <span class="nx">state</span>       <span class="nx">nodeState</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">  <span class="nx">decision</span>    <span class="o">*</span><span class="nx">decision</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The <code>node</code> struct above lets us:</p>
<ul>
<li>Keep track of the node&rsquo;s <code>parent</code>, so we can easily go back up the tree when backtracking,</li>
<li>Keep track of the <code>nodeState</code>, which we&rsquo;ll use to tell us what to do when we visit or revisit a node,</li>
<li>Keep track of the <code>decision</code> we made at this node, which we can use to evaluate constraints, and, when all variables are assigned, to tell us what the full solution is, by walking backwards up the tree and collapsing all the decisions that led to the solution into a full assignment of values to variables.</li>
</ul>
<h2 id="building-the-search-tree" class="headerLink">
    <a href="#building-the-search-tree" class="header-mark"></a>Building the search tree</h2><p>My code has two key functions: <code>Run()</code>, which is the top-level function called by external clients, like the web server, and <code>step()</code>, which is a single step in the search tree where we look at the current <code>node.state</code> and decide what to do next. Here they are, along with the <code>Search</code> struct that they belong to:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-golang" data-lang="golang"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="kd">type</span> <span class="nx">Search</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 2</span><span class="cl">  <span class="nx">root</span> <span class="o">*</span><span class="nx">node</span>
</span></span><span class="line"><span class="ln"> 3</span><span class="cl">  <span class="nx">current</span> <span class="o">*</span><span class="nx">node</span>
</span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">
</span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Search</span><span class="p">)</span> <span class="nf">Run</span><span class="p">()</span> <span class="o">*</span><span class="nx">Solution</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">  <span class="k">for</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="nx">done</span><span class="p">,</span> <span class="nx">solution</span> <span class="o">:=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="k">if</span> <span class="nx">done</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">10</span><span class="cl">      <span class="k">return</span> <span class="nx">solution</span>
</span></span><span class="line"><span class="ln">11</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="ln">14</span><span class="cl">
</span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">s</span> <span class="o">*</span><span class="nx">Search</span><span class="p">)</span> <span class="nf">step</span><span class="p">()</span> <span class="p">(</span><span class="kt">bool</span><span class="p">,</span> <span class="o">*</span><span class="nx">Solution</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">16</span><span class="cl">  <span class="k">switch</span> <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">state</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">17</span><span class="cl">  <span class="k">case</span> <span class="nx">freshNode</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">decision</span> <span class="p">=</span> <span class="nx">s</span><span class="p">.</span><span class="nf">makeNextDecision</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="k">if</span> <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">decision</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">20</span><span class="cl">      <span class="c1">// When there are no more variables to assign s.makeNextDecision()
</span></span></span><span class="line"><span class="ln">21</span><span class="cl"><span class="c1"></span>      <span class="c1">// returns nil. That also means that all variables are assigned
</span></span></span><span class="line"><span class="ln">22</span><span class="cl"><span class="c1"></span>      <span class="c1">// and we found a solution.
</span></span></span><span class="line"><span class="ln">23</span><span class="cl"><span class="c1"></span>      <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">state</span> <span class="p">=</span> <span class="nx">solutionFound</span>
</span></span><span class="line"><span class="ln">24</span><span class="cl">      <span class="k">return</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">s</span><span class="p">.</span><span class="nf">Assignments</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">25</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">26</span><span class="cl">
</span></span><span class="line"><span class="ln">27</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">decision</span><span class="p">.</span><span class="nx">variable</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">decision</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">28</span><span class="cl">    <span class="k">if</span> <span class="p">!</span><span class="nx">s</span><span class="p">.</span><span class="nf">checkConstraints</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">29</span><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="ln">30</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">31</span><span class="cl">
</span></span><span class="line"><span class="ln">32</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">state</span> <span class="p">=</span> <span class="nx">assignmentTried</span>
</span></span><span class="line"><span class="ln">33</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{</span><span class="nx">parent</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">34</span><span class="cl">  <span class="k">case</span> <span class="nx">solutionFound</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">35</span><span class="cl">    <span class="c1">// We can get here if we&#39;re resuming from a previous solution.
</span></span></span><span class="line"><span class="ln">36</span><span class="cl"><span class="c1"></span>    <span class="c1">// We&#39;ll resume by backtracking out of this node.
</span></span></span><span class="line"><span class="ln">37</span><span class="cl"><span class="c1"></span>    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span> <span class="p">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">parent</span>
</span></span><span class="line"><span class="ln">38</span><span class="cl">  <span class="k">case</span> <span class="nx">assignmentTried</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">39</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nf">undoLastStep</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">40</span><span class="cl">
</span></span><span class="line"><span class="ln">41</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">decision</span><span class="p">.</span><span class="nx">valueAssigned</span> <span class="p">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="ln">42</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">decision</span><span class="p">.</span><span class="nx">variable</span><span class="p">.</span><span class="nf">Prune</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">decision</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
</span></span><span class="line"><span class="ln">43</span><span class="cl">    <span class="k">if</span> <span class="p">!</span><span class="nx">s</span><span class="p">.</span><span class="nf">checkConstraints</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">44</span><span class="cl">      <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="ln">45</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">46</span><span class="cl">
</span></span><span class="line"><span class="ln">47</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">state</span> <span class="p">=</span> <span class="nx">unassignmentTried</span>
</span></span><span class="line"><span class="ln">48</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">node</span><span class="p">{</span><span class="nx">parent</span><span class="p">:</span> <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">}</span>
</span></span><span class="line"><span class="ln">49</span><span class="cl">  <span class="k">case</span> <span class="nx">unassignmentTried</span><span class="p">:</span>
</span></span><span class="line"><span class="ln">50</span><span class="cl">    <span class="k">if</span> <span class="nx">s</span><span class="p">.</span><span class="nx">current</span> <span class="o">==</span> <span class="nx">s</span><span class="p">.</span><span class="nx">root</span> <span class="p">{</span>
</span></span><span class="line"><span class="ln">51</span><span class="cl">      <span class="c1">// We exhausted the search space, no solutions are left.
</span></span></span><span class="line"><span class="ln">52</span><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="ln">53</span><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="ln">54</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nf">undoLastStep</span><span class="p">()</span>
</span></span><span class="line"><span class="ln">55</span><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">current</span> <span class="p">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">current</span><span class="p">.</span><span class="nx">parent</span>
</span></span><span class="line"><span class="ln">56</span><span class="cl">    <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="ln">57</span><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="ln">58</span><span class="cl">  <span class="k">return</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="ln">59</span><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>As you can see, <code>Run()</code> is exceptionally straight-forward - it simply keeps calling <code>step()</code> until <code>step()</code> says it is <code>done</code>, which happens either because a solution has been found, or the entire search space has been exhausted, and no more solutions as exist.</p>
<p>On the other hand, <code>step()</code> is a bit more complicated - it looks at the state that the current node is in and:</p>
<ul>
<li>For <code>freshNode</code> search makes a decision; if that&rsquo;s <code>nil</code> then we have a solution. Otherwise, we assign the variable, check constraints, and if no constraints are violated, create a child node and move into it. If at least one constraint is violated no solution can be found in this branch and we will need to try the other branch, relying on <code>Run()</code> to enter <code>assignmentTried</code> on next step.</li>
<li>For <code>solutionFound</code> - this state will be entered when <code>Run()</code> is called again after finding a solution. In this case search simply backtracks, so that search can continue to the next solution.</li>
<li>For <code>assignmentTried</code> search flips the assignment to <em>unassignment</em> (e.g., if the assignment was A = 5 it&rsquo;ll become A â‰  5). This is where the binary nature of the search tree comes from, that I mentioned in my other posts. Search will then prune the unassigned value from the variable&rsquo;s live domain, and check if any constraints are broken (we&rsquo;ll talk about live domains in another post, for now just think of this as removing this value as a possibility for the subtree rooted at the current node). If no constraints are broken search will traverse deeper into the search tree, otherwise no solution can be found and <code>step()</code> will return, relying on <code>Run()</code> to trigger a backtrack on the next step.</li>
<li>For <code>unassignmentTried</code> search knows that at this point no more solutions can be found in the current subtree and it needs to backtrack. If search detects that it is already at the root node, that means it has nowhere to backtrack to and there are no more solutions at all.</li>
</ul>
<p>And that&rsquo;s the heart of the constructive search algorithm. A few important things are left out for now though, which make what is essentially just DFS effective. I&rsquo;ll cover these later, but I will touch on them briefly here:</p>
<ul>
<li>Applying <em>constraint propagation</em> after making decisions, rather than simply checking constraints, and tracking results of propagation, so that they may be retracted upon backtracking. This will allow search to quickly eliminate parts of search space that are guaranteed to not contain solutions.</li>
<li>Heuristics and decision making in general are alluded to with <code>s.makeNextDecision()</code>, but not fleshed out. This part delegates the heavy lifting to the variable and value ordering heuristics, and while those can be as simple as lexicographic, can get relatively sophisticated.</li>
<li>Supporting <em>backjumping</em> rather than just simple backtracking.</li>
</ul></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-09-03</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line print:!tw-hidden">
            <div class="post-info-md"></div>
            <div class="post-info-share"></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg>&nbsp;<a href="/tags/algorithms/">Algorithms</a>,&nbsp;<a href="/tags/go/">Go</a></section>
        <section class="print:!tw-hidden">
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav print:tw-hidden"><a href="/posts/solver-basics/" class="prev" rel="prev" title="Solver basics"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"/></svg>Solver basics</a>
            <a href="/posts/constraint-propagation/" class="next" rel="next" title="Constraint Propagation">Constraint Propagation<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></a></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.124.1">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg> DoIt</a>
                </div><div class="footer-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 448c-110.532 0-200-89.451-200-200 0-110.531 89.451-200 200-200 110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200zm107.351-101.064c-9.614 9.712-45.53 41.396-104.065 41.396-82.43 0-140.484-61.425-140.484-141.567 0-79.152 60.275-139.401 139.762-139.401 55.531 0 88.738 26.62 97.593 34.779a11.965 11.965 0 0 1 1.936 15.322l-18.155 28.113c-3.841 5.95-11.966 7.282-17.499 2.921-8.595-6.776-31.814-22.538-61.708-22.538-48.303 0-77.916 35.33-77.916 80.082 0 41.589 26.888 83.692 78.277 83.692 32.657 0 56.843-19.039 65.726-27.225 5.27-4.857 13.596-4.039 17.82 1.738l19.865 27.17a11.947 11.947 0 0 1-1.152 15.518z"/></svg>2024<span class="author">&nbsp;<a href="/" target="_blank" rel="noopener noreferrer">Andrei</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons" class="print:!tw-hidden"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"/></svg>
        </a>
    </div><div class="assets"><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10000},"comment":{}};</script><script
    src="/lib/clipboard/clipboard.min.js"
    
  ></script><script
    src="/js/theme.min.js"
    
      defer
    
  ></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-WS2FCBYJLF');
        </script><script
    src="https://www.googletagmanager.com/gtag/js?id=G-WS2FCBYJLF"
    async
  ></script></div>
</body>

</html>
