<!doctype html>

<html lang="en-us">

<head>
  <title>Solver basics - Blog of the Dad</title>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="description" content="The HTML5 Herald" />
<meta name="author" content="Andrei" /><meta property="og:title" content="Solver basics" />
<meta property="og:description" content="In the previous post I&rsquo;ve given a quick overview of what the solver is about, and in this post I&rsquo;ll dive a little bit deeper into the subject, using N-queens with just 4 queens as an example problem. More specifically, I&rsquo;ll fully specify the problem by defining the variables and constraints, and then walk through what a simple search would do, ultimately finding a solution." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.dawnofthe.dad/posts/solver-basics/" /><meta property="og:image" content="https://blog.dawnofthe.dad/thinking.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-02T12:49:25-07:00" />
<meta property="article:modified_time" content="2023-09-02T12:49:25-07:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.dawnofthe.dad/thinking.png"/>

<meta name="twitter:title" content="Solver basics"/>
<meta name="twitter:description" content="In the previous post I&rsquo;ve given a quick overview of what the solver is about, and in this post I&rsquo;ll dive a little bit deeper into the subject, using N-queens with just 4 queens as an example problem. More specifically, I&rsquo;ll fully specify the problem by defining the variables and constraints, and then walk through what a simple search would do, ultimately finding a solution."/>

<meta name="generator" content="Hugo 0.117.0">
    
    <script src="/js/mathjax-config.js" defer></script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />
  <link rel="stylesheet" href="https://blog.dawnofthe.dad/fontawesome/css/all.min.css" />
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  
  
  <link rel="stylesheet" type="text/css" href="/css/styles.css" />
</head>

<body>
  <div id="container">
    <header>
      
      <h1>
        <a href="/">Blog of the Dad</a>
      </h1>

      <ul id="social-media">
             <li>
               <a href="https://twitter.com/userundefinedrd" title="Twitter">
               <i class="fab fa-twitter fa-lg"></i>
               </a>
             </li>
      </ul>
      
      <p><em>Donâ€™t eat me. I have a wife and kids. Eat them.</em></p>
      
    </header>

    
<nav>
    <ul>
        
    </ul>
</nav>


    <main>




<article>

    <h1>Solver basics</h1>

    
      <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2023-09-02T12:49:25-07:00">Sep 2, 2023</time>
        </li>
        
        

        
        <li>
            <em>
                
                    
                    <a href="/tags/backtracking">#Backtracking</a>
                
                    , 
                    <a href="/tags/constructive-search">#Constructive search</a>
                
            </em>
        </li>
        

        <li>7 minute read</li>
    </ul>
</aside>

    

    
      
<div class="featured_image">
    <a href="https://blog.dawnofthe.dad/posts/solver-basics/" title="Solver basics">
        <img src="/thinking.png">
    </a>
</div>


    

    <p>In the previous post I&rsquo;ve given a quick overview of what the solver is about, and in this post I&rsquo;ll dive a little bit deeper into the subject, using N-queens with just 4 queens as an example problem. More specifically, I&rsquo;ll fully specify the problem by defining the variables and constraints, and then walk through what a simple search would do, ultimately finding a solution.</p>
<h2 id="closer-look-at-n-queens-problem">Closer look at N-queens problem</h2>
<p>To recap the previous post, the goal of solving the N-queens problem is to find a way to place N queens on an NxN chessboard in a way that the queens are not attacking each other. I also mentioned that a common way of modeling this problem is by having over variable per queen, where variable M represents the queen in column M, and this model choice effectively ensures that no pair of queens share the same column. One thing I omitted earlier is that each variable is also associated with its <em>domain</em>, which is basically the set of values that could be assigned to the variable. For N-queens the domain of all variables is $\set{1, &hellip;, N}$. A value from this domain simply represents with row, from $1$ to $N$, that a particular queen is assigned to.</p>
<p>Constraints for N-queens get a little bit more interesting: by the definition of variables we know that no pair of queens will attack each other vertically, since they cannot share the same column, but we still need to make sure they will not attack each other horizontally and diagonally.</p>
<ul>
<li><strong>Preventing horizontal attacks</strong> is the same thing as making sure that each queen is assigned to a different row, and this is a perfect example of applying the <em>all-different</em> constraint. There are different ways of implementing such a constraint, but the net outcome is the same - all variables that are part of such a constraint must be assigned to different values. So we&rsquo;ll define one <em>all-different</em> constraint and apply it to all of the 4 queens, as this prevents them from horizontally attacking each other.</li>
<li><strong>Preventing diagonal attacks</strong> will require doing a bit of math to define the constraint: we know that when a pair of queens share a diagonal if we can draw a line between them with a slope of 1 or -1, and we want to prevent that. Using the &ldquo;rise over run&rdquo; formula we can express that as $$abs((y_2-y_1) / (x_2 - x_1)) \ne 1$$ Let&rsquo;s get rid of division, because dealing with floats is not fun: $$abs(y_2 - y_1) \ne abs(x_2-x_1)$$ With that, we just need to add constraints for each pair of queens, so that gives us $${n \choose 2} = n(n-1)/2$$ binary constraints.</li>
</ul>
<p>This completes the definition of an N-queens problem.</p>
<h2 id="search-and-n-queens">Search and N-queens</h2>
<p>Now that we&rsquo;ve defined the N-queens problem, let&rsquo;s see what searching for a solution looks like. We&rsquo;ll look at the smallest non-trivial N-queens problem with a solution, which happens to be with 4 queens.</p>
<p>There are a couple more things to mention about search:</p>
<ul>
<li>Making the right decisions during search is critical. For this, typically two types of heuristics are used: <em>variable ordering heuristics</em>, which I mentioned in the previous post, and <em>value ordering heuristics</em>. They tell search which variable to assign next, and to what value. Here we&rsquo;ll assume that both are using lexicographic ordering, meaning we&rsquo;ll assign queen in column 1 first (call it Q1), then in columns 2, 3 and finally 4. We&rsquo;ll do the same for values; i.e., rows that we assign the queens to.</li>
<li>The other thing done during search is called <em>constraint propagation</em>, which basically says &ldquo;after search assigns a value, it will proactively adjust other unassigned variables by removing values that would break a constraint&rdquo;. That might sound a bit complicated, so for now, we&rsquo;ll assume that we don&rsquo;t do this, and only evaluate constraints when picking the next value.</li>
</ul>
<p>We can now look at the example search for the 4-queens problem:</p>
<p><img src="/4q-tree.svg" alt="Search tree for the 4 queens problem"></p>
<p>In the diagram above, labels next to nodes represent the decision made to reach the node (aside from root node); e.g.; &ldquo;Q2:3&rdquo; means &ldquo;assign queen in column #2 to row 3&rdquo;. Because we are using lexicographic variable ordering you&rsquo;ll also note that each level in the tree corresponds to assigning the next queen. In cases where we find it impossible to assign a value to the next queen without violating a constraint, we&rsquo;ll label those with &ldquo;X&rdquo;; e.g., &ldquo;Q4:X&rdquo; means &ldquo;we couldn&rsquo;t place queen in column 4 as every possible spot is already under attack&rdquo;. Those are always followed by a backtrack.</p>
<h3 id="explaining-search-steps">Explaining search steps</h3>
<ul>
<li>Start with no decisions made at the root of the search tree.</li>
<li>Assign Q1 to 1; i.e., to place queen in column #1 on row #1. Then create a new child node and step into it.</li>
<li>Now we&rsquo;ll assign Q2. Placement of Q1 means that Q2 cannot be on row #1 (horizontal constraint, aka all different constraint, is violated) or on row #2 (diagonal constraint is violated). So we&rsquo;ll place it on row #3, create another child node, and step into it.</li>
<li>Now we&rsquo;re <em>attempting</em> to assign Q3. This is where things get more interesting: row #1 is under attack by Q1, and rows #2 through #4 are under attack by Q2. No decision can be made and we&rsquo;ve hit a dead end. This is where <em>backtracking</em> must take place, which basically means going back to the parent of the current node and stating that the decision it made earlier leads to no solutions. This is the leftmost leaf node with an X on it in the diagram.</li>
<li>We&rsquo;re now back to finding a new value for Q2, as assigning it to row #3 didn&rsquo;t work. Search will try row #4, and, as usual, create a child node for that and step into it.</li>
<li>We&rsquo;re trying to assign Q3 again. Row #1 is still under attack by Q1, however, now that we&rsquo;ve moved Q2 to row #4, Q3 can go on row #2. We&rsquo;ll make this decision, create a new child node, and step into that.</li>
<li>We&rsquo;re now down to our last queen - Q4! Alas, looking for a viable place to put it we&rsquo;ll see that row #1 is taken by Q1, row #2 by Q3, row #3 is under attack diagonally by Q3, and #row 4 is already taken by Q2. We cannot place Q4 without attacking one of the other queens, and we must backtrack.</li>
<li>Q3 must be moved from row #2, but it has nowhere else to go - we can&rsquo;t place it on row #3 because Q1 attacks that diagonally, and #4 is already under attack by Q2. We must backtrack again.</li>
<li>Q2 must now be moved from row #4, but Q2 has exhausted possible places it could be placed, so we backtrack once again, and end up at the root node.</li>
<li>After all that work we learned that Q1 cannot be on row #1 and we&rsquo;re back at the root node. We must try the next value, row #2, create a new child and step into it. Thankfully, the rest of the search is backtrack-free.</li>
<li>Q2 can only be on row #4 because Q1 attacks all others. So we place it, create a new child and step into that.</li>
<li>Q3 can only be on row #1 now. We do that, and create a new child + step into that again.</li>
<li>Q4 is last, and luckily it can be placed on row #3. All the variables are now assigned and none of the constraints are violated, and thus we have a solution!</li>
</ul>
<p>Side-note: my solver always makes binary decisions, so the logic would have been more like &ldquo;try X, and if that fails, try <em>not</em> X&rdquo;. The net result would still be the same, but we would have a few more nodes in the search tree. I&rsquo;ll cover the more exact mechanics of my solver separately.</p>
<h2 id="summary">Summary</h2>
<p>We&rsquo;ve looked at how N-queens problem can be modeled as a constraint satisfaction problem, and how search traverses the search space by incrementally building up a search tree. We saw how the constraints prevent us from visiting parts of the tree that have no solutions, and how we recover from failure to find a solution in subtrees.</p>

</article>


<section class="post-nav">
    <ul>
        <li>
        
            <a href="https://blog.dawnofthe.dad/posts/solver-intro/"><i class="fa fa-chevron-circle-left"></i> Solver intro</a>
        
        </li>
        <li>
        
        </li>
    </ul>
</section>
  
    
    
  





</main>
<footer>
  <ul>
    <li>
      <h6>
        Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a></h6>
    </li>
    
    
  </ul>
</footer>
</div>
<script src="/%20js/scripts.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-WS2FCBYJLF"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-WS2FCBYJLF', { 'anonymize_ip': false });
}
</script>



</body>

</html>
