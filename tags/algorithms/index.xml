
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
 <channel>
   <title>Algorithms on Blog of the Dad</title>
   <link>https://blog.dawnofthe.dad/tags/algorithms/</link>
   <description>Recent content in Algorithms on Blog of the Dad</description>
   <generator>Hugo -- gohugo.io</generator>
   <language>en-us</language>
   <lastBuildDate>Mon, 04 Sep 2023 15:59:06 -0700</lastBuildDate>
   
       <atom:link href="https://blog.dawnofthe.dad/tags/algorithms/index.xml" rel="self" type="application/rss+xml" />
   
   
     <item>
       <title>Constraint Propagation</title>
       <link>https://blog.dawnofthe.dad/posts/constraint-propagation/</link>
       <pubDate>Mon, 04 Sep 2023 15:59:06 -0700</pubDate>
       
       <guid>https://blog.dawnofthe.dad/posts/constraint-propagation/</guid>
       <description>&lt;p&gt;Constraint propagation is one of the key mechanisms that allows constructive search to efficiently explore huge search spaces. It does so by applying constraints whenever search state changes to remove parts of search space that cannot contain solutions.&lt;/p&gt;&lt;p&gt;In this post I&amp;rsquo;ll cover two constraint propagation techniques: forward checking and arc consistency. As these techniques apply to variables&amp;rsquo; live domains, I&amp;rsquo;ll start by defining what that is first, and then dive into constraint propagation itself.&lt;/p&gt;&lt;h2 id=&#34;variables-and-domains&#34;&gt;Variables and domains&lt;/h2&gt;&lt;p&gt;Variables in CSPs are associated with their &lt;em&gt;domains&lt;/em&gt;, for example, in &lt;a href=&#34;https://blog.dawnofthe.dad/posts/solver-basics/&#34;&gt;N-queens problem&lt;/a&gt; each variable represents a queen in a particular column and its domain represents the N possible rows that the queen may be assigned to; in order to find a solution to the CSP we must assign variables to exactly one value from their respective domains such that no constraints are violated. Before we discuss constraint propagation it would help to define another concept - &lt;em&gt;live domain&lt;/em&gt;.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Live domain&lt;/strong&gt; of a variable V is a subset of values from V&amp;rsquo;s domain that may still be part of a solution. Unlike domain of a variable, which is static and defined once as part of the CSP, live domain changes throughout the search:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Decisions made during search can directly affect a variable&amp;rsquo;s live domain. For example, choosing to assign a queen to a particular row, let&amp;rsquo;s call it &lt;em&gt;k&lt;/em&gt;, will mutate its live domain to be just that value; i.e., {&lt;em&gt;k&lt;/em&gt;}.&lt;/li&gt;&lt;li&gt;Similarly, some decisions may result in &lt;em&gt;pruning&lt;/em&gt; values from the live domain, like stating that a queen cannot be on row &lt;em&gt;m&lt;/em&gt;, and that would lead us to remove &lt;em&gt;m&lt;/em&gt; from the live domain of the variable for that queen.&lt;/li&gt;&lt;li&gt;Constraint propagation is the other, key mechanism that prunes values from live domain of variables, by removing values that are guaranteed to not be part of a solution given the current search state.&lt;/li&gt;&lt;li&gt;The cases above all remove values from live domains, and apply as we traverse deeper into the search tree. When we go back up the search tree it is important to remember to restore variables&amp;rsquo; live domains.&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&#34;constraint-propagation&#34;&gt;Constraint propagation&lt;/h2&gt;&lt;p&gt;As search traverses deeper into a particular subtree a few things happen:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Decisions made on the path from the current node to the root reduce the search space, with the goal of finding a solution, or proving none exists in this subtree.&lt;/li&gt;&lt;li&gt;As those decisions are made, and as mentioned above, live domains of variables will be reduced, reflecting the reduction of search space as the search traverses deeper down the search tree.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;Constraint propagation&lt;/strong&gt; is the idea that when live domains of variables change, we have the opportunity to examine constraints of the CSP and use those to &lt;em&gt;further&lt;/em&gt; reduce live domains by removing (aka pruning) values that would otherwise be guaranteed to violate constraints. For example, with N-queens, whenever we assign some queen to row &lt;em&gt;k&lt;/em&gt; we know that the other queens cannot be on row &lt;em&gt;k&lt;/em&gt; now without being attacked, and can remove &lt;em&gt;k&lt;/em&gt; from their live domains. Let&amp;rsquo;s look at the two constraint propagation algorithms, and then look at how one might code those up.&lt;/p&gt;&lt;h3 id=&#34;forward-checking&#34;&gt;Forward checking&lt;/h3&gt;&lt;p&gt;Forward checking is a relatively simple and effective constraint propagation technique that can be summed up as follows:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;When a variable V&amp;rsquo;s live domain changes, grab all constraints that involve the variable.&lt;/li&gt;&lt;li&gt;Look at each constraint one at a time. For each such constraint C, look at all the &lt;em&gt;other&lt;/em&gt; variables that are part of the constraint.&lt;/li&gt;&lt;li&gt;For each such variable U â‰  V of C look at the live domain of U and see which values of U&amp;rsquo;s live domain can still be a part of a solution without violating C. Any values that don&amp;rsquo;t meet this criterion are removed from U&amp;rsquo;s live domain.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;This last part is a bit tricky. Let&amp;rsquo;s look at the simplest case first, where we have binary constraints, like the diagonal constraint from N-queens, and just assigned one of the variables (i.e., placed one of the queens):&lt;/p&gt;&lt;ul&gt;&lt;li&gt;In this case, as we apply forward checking, we want to adjust the live domain of the other queen to remove values (row numbers) that would now be diagonally under attack.&lt;/li&gt;&lt;li&gt;We&amp;rsquo;d apply this to all the constraints that the assigned queen is involved in, thus updating live domains of possibly many other queens.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The more general case can involve constraints with many variables involved, like &lt;em&gt;all-different&lt;/em&gt; constraint, and possibly only partial live-domain changes, rather than reductions to a single assigned value. In this case we need to rely on &lt;strong&gt;supports&lt;/strong&gt; of a constraint. A support is defined as a set of assignments of values to all variables involved in a constraint that do not violate the constraint. Coming back to constraint propagation, the last step of forward checking means that as we look at live domains of variables, we should remove any values that can no longer be supported given the current state of search.&lt;/p&gt;&lt;p&gt;Let&amp;rsquo;s explain this last bit with an example, this time looking at &lt;em&gt;all-different&lt;/em&gt; constraint defined on 4 queens, which tells us that all 4 queens must be assigned to unique rows. Now, suppose that:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Initially Q1 (using the same notation as in the &lt;a href=&#34;https://blog.dawnofthe.dad/posts/solver-basics/&#34;&gt;older post&lt;/a&gt;) has live domain of {1, 2, 3}, Q2 has live domain of {1, 2}, Q3 has live domain of {3, 4} and Q4 has live domain of {3}.&lt;/li&gt;&lt;li&gt;If we assign Q1 to 3, we will end up removing 3 from live domain of Q3 and Q4.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;One interesting and important bit about this simple example is that this would mean that Q4 now has an empty live domain. This is referred to as a &lt;em&gt;wipeout&lt;/em&gt; and means that we won&amp;rsquo;t be able to find a solution in this part of the search space &lt;strong&gt;and must backtrack&lt;/strong&gt;. This is one of the key benefits of constraint propagation - by doing a bit of work up-front, not only can we reduce work further down in the search tree, but we can sometimes detect infeasibility (i.e., absence of a solution) early, and backtrack right away.&lt;/p&gt;&lt;h3 id=&#34;arc-consistency&#34;&gt;Arc consistency&lt;/h3&gt;&lt;p&gt;Arc consistency is another constraint propagation technique that is more powerful (and more expensive to evaluate) than forward checking. Tersely speaking it:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Keeps track of variables whose live domains have changed. It starts by seeding a set S of variables with the variable that was affected by the latest decision.&lt;/li&gt;&lt;li&gt;Removes a variable from S and applies forward checking as described above. As this is done, any variables with live domain reductions are added to S.&lt;/li&gt;&lt;li&gt;Keeps going until S becomes empty, meaning no further live domain changes happen.&lt;/li&gt;&lt;/ol&gt;&lt;p&gt;Arc consistency generally leads to fewer backtracks than forward-checking, as infeasibility can be detected faster, however arc consistency requires more constraint evaluations and can be significantly slower per iteration. As such, whether you should use forward checking or arc consistency tends to depend on the problem &lt;strong&gt;and&lt;/strong&gt; the implementation of constraints. Benchmarking generally can help you choose the right constraint propagation approach.&lt;/p&gt;&lt;h3 id=&#34;code&#34;&gt;Code&lt;/h3&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 1&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;// propagate returns true when no live domains are wiped out.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 2&lt;/span&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Search&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;propagate&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;arcConsistency&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 3&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;changedVars&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;map&lt;/span&gt;[&lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;model&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Variable&lt;/span&gt;]&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;{}&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 4&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;changedVars&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;decision&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;variable&lt;/span&gt;] = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 5&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; len(&lt;span style=&#34;color:#a6e22e&#34;&gt;changedVars&lt;/span&gt;) &lt;span style=&#34;color:#f92672&#34;&gt;!=&lt;/span&gt; &lt;span style=&#34;color:#ae81ff&#34;&gt;0&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 6&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;var&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;nextV&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;model&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Variable&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;pop&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;changedVars&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 7&lt;/span&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;problem&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;ConstraintsFor&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;nextV&lt;/span&gt;) {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 8&lt;/span&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;_&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;cv&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;range&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Variables&lt;/span&gt;() {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt; 9&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;liveDomainChanged&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;10&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#a6e22e&#34;&gt;cv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;LiveDomain&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;ForEachValue&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;) &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;11&lt;/span&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;c&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Supported&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;cv&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;) {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;12&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;prune&lt;/span&gt;(&lt;span style=&#34;color:#a6e22e&#34;&gt;cv&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;val&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;13&lt;/span&gt;&lt;span&gt;            &lt;span style=&#34;color:#a6e22e&#34;&gt;liveDomainChanged&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;14&lt;/span&gt;&lt;span&gt;          }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;15&lt;/span&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;16&lt;/span&gt;&lt;span&gt;        })&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;17&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; !&lt;span style=&#34;color:#a6e22e&#34;&gt;liveDomainChanged&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;18&lt;/span&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;continue&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;19&lt;/span&gt;&lt;span&gt;        }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;20&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;cv&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;WipedOut&lt;/span&gt;() {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;21&lt;/span&gt;&lt;span&gt;          &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;22&lt;/span&gt;&lt;span&gt;        }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;23&lt;/span&gt;&lt;span&gt;        &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;arcConsistency&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;24&lt;/span&gt;&lt;span&gt;          &lt;span style=&#34;color:#a6e22e&#34;&gt;changedVars&lt;/span&gt;[&lt;span style=&#34;color:#a6e22e&#34;&gt;cv&lt;/span&gt;] = &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;25&lt;/span&gt;&lt;span&gt;        }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;26&lt;/span&gt;&lt;span&gt;      }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;27&lt;/span&gt;&lt;span&gt;    }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;28&lt;/span&gt;&lt;span&gt;  }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;29&lt;/span&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span style=&#34;white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f&#34;&gt;30&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The block above applies constraint propagation, and the logic between forward checking and arc consistency is really just about adding changed variables to &lt;code&gt;changedVars&lt;/code&gt; on lines 23-25, and is gated by the bool passed to  &lt;code&gt;propagate()&lt;/code&gt; where &lt;code&gt;arcConsistency&lt;/code&gt; being false means that forward checking will be applied instead. The key parts are:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Lines 3-5 initialize &lt;code&gt;changedVars&lt;/code&gt; and keep going so long as this &amp;ldquo;set&amp;rdquo; isn&amp;rsquo;t empty.&lt;/li&gt;&lt;li&gt;Line 6 grabs the next variable &lt;code&gt;nextV&lt;/code&gt; to process.&lt;/li&gt;&lt;li&gt;Line 7 goes through all the constraints &lt;code&gt;c&lt;/code&gt; of &lt;code&gt;nextV&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;Line 8 goes through all variables &lt;code&gt;cv&lt;/code&gt; of &lt;code&gt;c&lt;/code&gt;.&lt;/li&gt;&lt;li&gt;Lines 9-22 apply the core of forward checking algorithm described above by checking all values of &lt;code&gt;cv&lt;/code&gt;&amp;rsquo;s live domain for supports of constraint &lt;code&gt;c&lt;/code&gt;, any that are not supported are removed, and if the entire domain of &lt;code&gt;cv&lt;/code&gt; is wiped out (made empty), &lt;code&gt;propagate()&lt;/code&gt; ends indicating that no solution exists.&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&#34;example-with-4-queens&#34;&gt;Example with 4-queens&lt;/h3&gt;&lt;p&gt;&lt;img src=&#34;https://blog.dawnofthe.dad/4q-prop.svg&#34; alt=&#34;4 queens problem and constraint propagation&#34;&gt;&lt;/p&gt;&lt;p&gt;Hopefully by now the header image makes sense - it&amp;rsquo;s an example of applying forward checking to 4-queens after placing the first queen, Q1, on row #1. You can also see that after placing Q1:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;code&gt;propagate(false)&lt;/code&gt;, with forward checking, would proactively prune live domains of the remaining queens, as shown in the diagram.&lt;/li&gt;&lt;li&gt;&lt;code&gt;propagate(true)&lt;/code&gt;, with arc consistency, would go quite a bit further and detect that placing Q2 on row #3 is not viable, because Q3&amp;rsquo;s live domain would be wiped out, and would remove row #3 from Q2&amp;rsquo;s domain. It would then notice that Q3 cannot be on row #4, because row #4 now must be taken by Q2, leaving Q3 with only row #2. And finally it would note that Q4 cannot go on row #2 because Q3 must be on row #2, and the diagonal attack prevents Q4 from going on row #3, thus wiping out Q4&amp;rsquo;s live domain and causing &lt;code&gt;propagate&lt;/code&gt; to prevent us from stepping any further into this subtree at all.&lt;/li&gt;&lt;/ul&gt;</description>
     </item>
   
     <item>
       <title>Search Algo in Go</title>
       <link>https://blog.dawnofthe.dad/posts/search-algo-in-go/</link>
       <pubDate>Sun, 03 Sep 2023 10:24:10 -0700</pubDate>
       
       <guid>https://blog.dawnofthe.dad/posts/search-algo-in-go/</guid>
       <description>&lt;p&gt;My previous couple of posts talked about &lt;a href=&#34;https://blog.dawnofthe.dad/posts/solver-intro/&#34;&gt;what the solver does (solves CSPs)&lt;/a&gt;, &lt;a href=&#34;https://blog.dawnofthe.dad/posts/solver-basics/&#34;&gt;how to model a problem as a CSP, and how the search tree is built&lt;/a&gt; as the solver searches for a solution. In this post I will expand on the details of search by outlining the key data structures and bits of code. The backend is written in &lt;a href=&#34;https://go.dev&#34;&gt;Go lang&lt;/a&gt;, and so are all of the code snippets here.&lt;/p&gt;&lt;h2 id=&#34;nodes-in-the-search-tree&#34;&gt;Nodes in the search tree&lt;/h2&gt;&lt;p&gt;We&amp;rsquo;ll be building a search tree, which is composed of nodes. We&amp;rsquo;ll also need to track a couple of things as we build the search tree. Here they are:&lt;/p&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;nodeState&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;const&lt;/span&gt; (&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;freshNode&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;nodeState&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;iota&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;solutionFound&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;assignmentTried&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;unassignmentTried&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;decision&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;variable&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;model&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Variable&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;value&lt;/span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;int&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#75715e&#34;&gt;// When true it means variable = value, when false it means variable != value.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;valueAssigned&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;node&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;parent&lt;/span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;node&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;// nil at root&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;state&lt;/span&gt;       &lt;span style=&#34;color:#a6e22e&#34;&gt;nodeState&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;decision&lt;/span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;decision&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;node&lt;/code&gt; struct above lets us:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Keep track of the node&amp;rsquo;s &lt;code&gt;parent&lt;/code&gt;, so we can easily go back up the tree when backtracking,&lt;/li&gt;&lt;li&gt;Keep track of the &lt;code&gt;nodeState&lt;/code&gt;, which we&amp;rsquo;ll use to tell us what to do when we visit or revisit a node,&lt;/li&gt;&lt;li&gt;Keep track of the &lt;code&gt;decision&lt;/code&gt; we made at this node, which we can use to evaluate constraints, and, when all variables are assigned, to tell us what the full solution is, by walking backwards up the tree and collapsing all the decisions that led to the solution into a full assignment of values to variables.&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&#34;building-the-search-tree&#34;&gt;Building the search tree&lt;/h2&gt;&lt;p&gt;My code has two key functions: &lt;code&gt;Run()&lt;/code&gt;, which is the top-level function called by external clients, like the web server, and &lt;code&gt;step()&lt;/code&gt;, which is a single step in the search tree where we look at the current &lt;code&gt;node.state&lt;/code&gt; and decide what to do next. Here they are, along with the &lt;code&gt;Search&lt;/code&gt; struct that they belong to:&lt;/p&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-golang&#34; data-lang=&#34;golang&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;type&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;Search&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;struct&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;root&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;node&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;node&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Search&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;Run&lt;/span&gt;() &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Solution&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;for&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;done&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;solution&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;:=&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;step&lt;/span&gt;()&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;done&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;solution&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;func&lt;/span&gt; (&lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Search&lt;/span&gt;) &lt;span style=&#34;color:#a6e22e&#34;&gt;step&lt;/span&gt;() (&lt;span style=&#34;color:#66d9ef&#34;&gt;bool&lt;/span&gt;, &lt;span style=&#34;color:#f92672&#34;&gt;*&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;Solution&lt;/span&gt;) {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;switch&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;state&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;freshNode&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;decision&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;makeNextDecision&lt;/span&gt;()&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;decision&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// Found a solution.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;state&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;solutionFound&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;, &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;Assignments&lt;/span&gt;()&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;state&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;assignmentTried&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt; = &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;node&lt;/span&gt;{&lt;span style=&#34;color:#a6e22e&#34;&gt;parent&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;solutionFound&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// We can get here if we&amp;#39;re resuming from a previous solution. We&amp;#39;ll resume&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// by backtracking out of this node.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;parent&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;assignmentTried&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;decision&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;valueAssigned&lt;/span&gt; = &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;state&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;unassignmentTried&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt; = &lt;span style=&#34;color:#f92672&#34;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;node&lt;/span&gt;{&lt;span style=&#34;color:#a6e22e&#34;&gt;parent&lt;/span&gt;: &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;case&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;unassignmentTried&lt;/span&gt;:&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;if&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt; &lt;span style=&#34;color:#f92672&#34;&gt;==&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;root&lt;/span&gt; {&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#75715e&#34;&gt;// We exhausted the search space, no solutions are left.&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;&lt;/span&gt;      &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt; = &lt;span style=&#34;color:#a6e22e&#34;&gt;s&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;current&lt;/span&gt;.&lt;span style=&#34;color:#a6e22e&#34;&gt;parent&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  }&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;false&lt;/span&gt;, &lt;span style=&#34;color:#66d9ef&#34;&gt;nil&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As you can see, &lt;code&gt;Run()&lt;/code&gt; is exceptionally straight-forward - it simply keeps calling &lt;code&gt;step()&lt;/code&gt; until &lt;code&gt;step()&lt;/code&gt; says it is &lt;code&gt;done&lt;/code&gt;, which happens either because a solution has been found, or the entire search space has been exhausted, and no more solutions as exist. On the other hand, &lt;code&gt;step()&lt;/code&gt; is a bit more complicated - it looks at the state that the current node is in and:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;For &lt;code&gt;freshNode&lt;/code&gt; search makes a decision; if that&amp;rsquo;s &lt;code&gt;nil&lt;/code&gt; then we have a solution, otherwise we create a child node and move into it.&lt;/li&gt;&lt;li&gt;For &lt;code&gt;solutionFound&lt;/code&gt; search simply backtracks, so that search can continue to the next solution.&lt;/li&gt;&lt;li&gt;For &lt;code&gt;assignmentTried&lt;/code&gt; search flips the assignment to &lt;em&gt;unassignment&lt;/em&gt; (e.g., if the assignment was A = 5 it&amp;rsquo;ll become A â‰  5). This is where the binary nature of the search tree comes from, that I mentioned in my other posts.&lt;/li&gt;&lt;li&gt;For &lt;code&gt;unassignmentTried&lt;/code&gt; search knows that at this point no more solutions can be found in the current subtree and it needs to backtrack. If search detects that it is already at the root node, that means it has nowhere to backtrack to and there are no more solutions at all.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;And that&amp;rsquo;s the heart of the constructive search algorithm. A few important things are left out for now though, which make what is essentially just DFS effective. I&amp;rsquo;ll cover these later, but I will touch on them briefly here:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Heuristics and decision making in general are alluded to with &lt;code&gt;s.makeNextDecision()&lt;/code&gt;, but not fleshed out. This part delegates the heavy lifting to the variable and value ordering heuristics, and while those can be as simple as lexicographic, can get relatively sophisticated.&lt;/li&gt;&lt;li&gt;Applying &lt;em&gt;constraint propagation&lt;/em&gt; after making decisions, and tracking its results, so that they may be retracted upon backtracking. This will allow search to quickly eliminate parts of search space that are guaranteed to not contain solutions.&lt;/li&gt;&lt;li&gt;Supporting &lt;em&gt;backjumping&lt;/em&gt; rather than just simple backtracking.&lt;/li&gt;&lt;/ul&gt;</description>
     </item>
   
     <item>
       <title>Solver basics</title>
       <link>https://blog.dawnofthe.dad/posts/solver-basics/</link>
       <pubDate>Sat, 02 Sep 2023 12:49:25 -0700</pubDate>
       
       <guid>https://blog.dawnofthe.dad/posts/solver-basics/</guid>
       <description>&lt;p&gt;In the &lt;a href=&#34;https://blog.dawnofthe.dad/posts/solver-intro/&#34;&gt;previous post&lt;/a&gt; I&amp;rsquo;ve given a quick overview of what the solver is about, and in this post I&amp;rsquo;ll dive a little bit deeper into the subject, using N-queens with just 4 queens as an example problem. More specifically, I&amp;rsquo;ll fully specify the problem by defining the variables and constraints, and then walk through what a simple search would do, ultimately finding a solution.&lt;/p&gt;&lt;h2 id=&#34;closer-look-at-n-queens-problem&#34;&gt;Closer look at N-queens problem&lt;/h2&gt;&lt;p&gt;To recap the previous post, the goal of solving the N-queens problem is to find a way to place N queens on an NxN chessboard in a way that the queens are not attacking each other. I also mentioned that a common way of modeling this problem is by having over variable per queen, where variable M represents the queen in column M, and this model choice effectively ensures that no pair of queens share the same column. One thing I omitted earlier is that each variable is also associated with its &lt;em&gt;domain&lt;/em&gt;, which is basically the set of values that could be assigned to the variable. For N-queens the domain of all variables is {1, &amp;hellip;, N}. A value from this domain simply represents the row, from 1 to N, that a particular queen is assigned to.&lt;/p&gt;&lt;p&gt;Constraints for N-queens get a little bit more interesting: by the definition of variables we know that no pair of queens will attack each other vertically, since they cannot share the same column, but we still need to make sure they will not attack each other horizontally and diagonally.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Preventing horizontal attacks&lt;/strong&gt; is the same thing as making sure that each queen is assigned to a different row, and this is a perfect example of applying the &lt;em&gt;all-different&lt;/em&gt; constraint. There are different ways of implementing such a constraint, but the net outcome is the same - all variables that are part of such a constraint must be assigned to different values. So we&amp;rsquo;ll define one &lt;em&gt;all-different&lt;/em&gt; constraint and apply it to all of the 4 queens, as this prevents them from horizontally attacking each other.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Preventing diagonal attacks&lt;/strong&gt; will require doing a bit of math to define the constraint: we know that when a pair of queens share a diagonal if we can draw a line between them with a slope of 1 or -1, and we want to prevent that. Using the &amp;ldquo;rise over run&amp;rdquo; formula we can express that as $$abs((y_2-y_1) / (x_2 - x_1)) \ne 1$$ Let&amp;rsquo;s get rid of division, because dealing with floats is not fun: $$abs(y_2 - y_1) \ne abs(x_2-x_1)$$ With that, we just need to add constraints for each pair of queens, so that gives us $${n \choose 2} = n(n-1)/2$$ binary constraints.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;This completes the definition of an N-queens problem.&lt;/p&gt;&lt;h2 id=&#34;search-and-n-queens&#34;&gt;Search and N-queens&lt;/h2&gt;&lt;p&gt;Now that we&amp;rsquo;ve defined the N-queens problem, let&amp;rsquo;s see what searching for a solution looks like. We&amp;rsquo;ll look at the smallest non-trivial N-queens problem with a solution, which happens to be with 4 queens.&lt;/p&gt;&lt;p&gt;There are a couple more things to mention about search:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Making the right decisions during search is critical. For this, typically two types of heuristics are used: &lt;em&gt;variable ordering heuristics&lt;/em&gt;, which I mentioned in the previous post, and &lt;em&gt;value ordering heuristics&lt;/em&gt;. They tell search which variable to assign next, and to what value. Here we&amp;rsquo;ll assume that both are using lexicographic ordering, meaning we&amp;rsquo;ll assign queen in column 1 first (call it Q1), then in columns 2, 3 and finally 4. We&amp;rsquo;ll do the same for values; i.e., rows that we assign the queens to.&lt;/li&gt;&lt;li&gt;The other thing done during search is called &lt;em&gt;constraint propagation&lt;/em&gt;, which basically says &amp;ldquo;after search assigns a value, it will proactively adjust other unassigned variables by removing values that would break a constraint&amp;rdquo;. That might sound a bit complicated, so for now, we&amp;rsquo;ll assume that we don&amp;rsquo;t do this, and only evaluate constraints when picking the next value.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We can now look at the example search for the 4-queens problem:&lt;/p&gt;&lt;p&gt;&lt;img src=&#34;https://blog.dawnofthe.dad/4q-tree.svg&#34; alt=&#34;Search tree for the 4 queens problem&#34;&gt;&lt;/p&gt;&lt;p&gt;In the diagram above, labels next to nodes represent the decision made to reach the node (aside from root node); e.g.; &amp;ldquo;Q2:3&amp;rdquo; means &amp;ldquo;assign queen in column #2 to row 3&amp;rdquo;. Because we are using lexicographic variable ordering you&amp;rsquo;ll also note that each level in the tree corresponds to assigning the next queen. In cases where we find it impossible to assign a value to the next queen without violating a constraint, we&amp;rsquo;ll label those with &amp;ldquo;X&amp;rdquo;; e.g., &amp;ldquo;Q4:X&amp;rdquo; means &amp;ldquo;we couldn&amp;rsquo;t place queen in column 4 as every possible spot is already under attack&amp;rdquo;. Those are always followed by a backtrack.&lt;/p&gt;&lt;h3 id=&#34;explaining-search-steps&#34;&gt;Explaining search steps&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;Start with no decisions made at the root of the search tree.&lt;/li&gt;&lt;li&gt;Assign Q1 to 1; i.e., to place queen in column #1 on row #1. Then create a new child node and step into it.&lt;/li&gt;&lt;li&gt;Now we&amp;rsquo;ll assign Q2. Placement of Q1 means that Q2 cannot be on row #1 (horizontal constraint, aka all different constraint, is violated) or on row #2 (diagonal constraint is violated). So we&amp;rsquo;ll place it on row #3, create another child node, and step into it.&lt;/li&gt;&lt;li&gt;Now we&amp;rsquo;re &lt;em&gt;attempting&lt;/em&gt; to assign Q3. This is where things get more interesting: row #1 is under attack by Q1, and rows #2 through #4 are under attack by Q2. No decision can be made and we&amp;rsquo;ve hit a dead end. This is where &lt;em&gt;backtracking&lt;/em&gt; must take place, which basically means going back to the parent of the current node and stating that the decision it made earlier leads to no solutions. This is the leftmost leaf node with an X on it in the diagram.&lt;/li&gt;&lt;li&gt;We&amp;rsquo;re now back to finding a new value for Q2, as assigning it to row #3 didn&amp;rsquo;t work. Search will try row #4, and, as usual, create a child node for that and step into it.&lt;/li&gt;&lt;li&gt;We&amp;rsquo;re trying to assign Q3 again. Row #1 is still under attack by Q1, however, now that we&amp;rsquo;ve moved Q2 to row #4, Q3 can go on row #2. We&amp;rsquo;ll make this decision, create a new child node, and step into that.&lt;/li&gt;&lt;li&gt;We&amp;rsquo;re now down to our last queen - Q4! Alas, looking for a viable place to put it we&amp;rsquo;ll see that row #1 is taken by Q1, row #2 by Q3, row #3 is under attack diagonally by Q3, and row #4 is already taken by Q2. We cannot place Q4 without attacking one of the other queens, and we must backtrack.&lt;/li&gt;&lt;li&gt;Q3 must be moved from row #2, but it has nowhere else to go - we can&amp;rsquo;t place it on row #3 because Q1 attacks that diagonally, and #4 is already under attack by Q2. We must backtrack again.&lt;/li&gt;&lt;li&gt;Q2 must now be moved from row #4, but Q2 has exhausted possible places it could be placed, so we backtrack once again, and end up at the root node.&lt;/li&gt;&lt;li&gt;After all that work we learned that Q1 cannot be on row #1 and we&amp;rsquo;re back at the root node. We must try the next value, row #2, create a new child and step into it. Thankfully, the rest of the search is backtrack-free.&lt;/li&gt;&lt;li&gt;Q2 can only be on row #4 because Q1 attacks all others. So we place it, create a new child and step into that.&lt;/li&gt;&lt;li&gt;Q3 can only be on row #1 now. We do that, and create a new child + step into that again.&lt;/li&gt;&lt;li&gt;Q4 is last, and luckily it can be placed on row #3. All the variables are now assigned and none of the constraints are violated, and thus we have a solution!&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Side-note: my solver always makes binary decisions, so the logic would have been more like &amp;ldquo;try X, and if that fails, try &lt;em&gt;not&lt;/em&gt; X&amp;rdquo;. The net result would still be the same, but we would have a few more nodes in the search tree. I&amp;rsquo;ll cover the more exact mechanics of my solver separately.&lt;/p&gt;&lt;h2 id=&#34;summary&#34;&gt;Summary&lt;/h2&gt;&lt;p&gt;We&amp;rsquo;ve looked at how N-queens problem can be modeled as a constraint satisfaction problem, and how search traverses the search space by incrementally building up a search tree. We saw how the constraints prevent us from visiting parts of the tree that have no solutions, and how we recover from failure to find a solution in subtrees.&lt;/p&gt;</description>
     </item>
   
     <item>
       <title>Solver intro</title>
       <link>https://blog.dawnofthe.dad/posts/solver-intro/</link>
       <pubDate>Sat, 26 Aug 2023 22:43:00 +0000</pubDate>
       
       <guid>https://blog.dawnofthe.dad/posts/solver-intro/</guid>
       <description>&lt;p&gt;The underlying general purpose solver is the most interesting and most complex part of the backend; it&amp;rsquo;s also the thing I have now rewritten 3 times for various reasons. So I&amp;rsquo;m going to talk about that a bit: what it does, why it is interesting and challenging to build, and where it is at today.&lt;/p&gt;&lt;h2 id=&#34;the-problem&#34;&gt;The problem&lt;/h2&gt;&lt;p&gt;The solver is designed to solve &lt;a href=&#34;https://en.wikipedia.org/wiki/Constraint_satisfaction_problem&#34;&gt;constraint satisfaction problems&lt;/a&gt;; aka CSPs. These problems are generally expressed by some number of variables with constraints on these variables. Here are a couple of examples of CSPs:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;N-queens problem&lt;/strong&gt;: for an NxN chess board, how can one position the queens such that none of them are attacking each other? A common way of expressing this as a CSP is to have one variable per column (because having more than one queen per column clearly violates the requirement that queens should not attack each other) and constraints that ensure that no two queens share a row, or a diagonal.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;&lt;strong&gt;Sudoku&lt;/strong&gt;: for a 9x9 grid, how can one fill in the grid with digits from 1 to 9 such that no row, column, or block has the digit appear more than once? A way to model this as a CSP is to have one variable per cell, so 81 variables total, and for each row, horizontal and block an &lt;em&gt;all-different&lt;/em&gt; constraint. Sudokus can also be generalized to NxN grids; e.g., 25x25 sudoku has cells which can be filled in with a value between 1 and 25 and 25 rows, columns, and blocks.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&#34;the-solver&#34;&gt;The solver&lt;/h2&gt;&lt;p&gt;There are a few different kinds of solvers for CSPs, the kind I have built is a constructive solver which has the ability to enumerate all solutions to a CSP, and similarly, guarantee that no solutions exist when that is the case. Here&amp;rsquo;s a quick rundown in bullet-form of how it works:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The core algorithm is building a tree that searches for a solution by making decisions, and after making a decision seeing if a solution still exists.&lt;/li&gt;&lt;li&gt;A decision is basically of the form &amp;ldquo;I think I can put the first queen on row #2&amp;rdquo;. Once a decision is made it holds until the solver either finds a solution that includes that decision, or proves that no solution exists with that decision.&lt;/li&gt;&lt;li&gt;When the solver does learn that no solutions exist based on an earlier decision, it backtracks; i.e., undoes that decision.&lt;/li&gt;&lt;li&gt;This algorithm will thus try all possibilities until an answer is found, or no answer is proven to exist.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;TL;DR: the algo is basically just DFS (depth first search). Easy peasy, right?&lt;/p&gt;&lt;p&gt;&amp;hellip; wait, the number of possible states gets pretty obscene, doesn&amp;rsquo;t it? Sure does! So how do we have any hope of finding a solution? Well, we&amp;rsquo;ll need to be smart about how we explore the possible states (aka the search space):&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;When making a decision we can be more careful about what that decision is. For example, we may want to pick a queen that only has two possible spots where it won&amp;rsquo;t be attacked. This is an example of &lt;em&gt;first fail&lt;/em&gt; variable ordering heuristic.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;After making a decision, like &amp;ldquo;first queen goes on row #2&amp;rdquo;, we can deduce that placing other queens on the same row doesn&amp;rsquo;t make any sense, and not attempt doing so. This is an example of &lt;em&gt;constraint propagation&lt;/em&gt;. Conveniently, this makes it easier for us to choose the next queen (see previous bullet point).&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;We can get smart about recovering from failing to find a solution. An example of this is &lt;em&gt;backjumping&lt;/em&gt;, where rather than going back to the latest decision, i.e., simply &lt;em&gt;backtracking&lt;/em&gt;, we jump further back and skip parts of the search tree that are guaranteed to not have a solution.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;I&amp;rsquo;ll cover these in separate posts, but for now hopefully this gives you an idea how the simplistic-looking DFS algorithm can be extended and handle traversing rather obscene search spaces.&lt;/p&gt;&lt;h3 id=&#34;why-its-hard-to-build&#34;&gt;Why it&amp;rsquo;s hard to build&lt;/h3&gt;&lt;p&gt;In short, because the search space is huge, optimization becomes critical. This applies to just about every step of the search process, from efficiently representing the problem and the search state, to efficiently updating the state and auxillary data structures, to quickly and correctly applying the techniques above, like constraint propagation and backjumping. I&amp;rsquo;ll cover these in more detail later as I intend to write some posts about different kinds of &lt;em&gt;all-different&lt;/em&gt; constraints, constraint propagation in general, and backjumping vs backtracking.&lt;/p&gt;&lt;h3 id=&#34;where-it-is-today&#34;&gt;Where it is today&lt;/h3&gt;&lt;p&gt;The solver runs on an E2 instance in Google Cloud, on freebie quota. As such, there are significant limitations to the CPU and RAM, yet it is still able to easily chew through most 15x15 crosswords and generalized NxN sudokus, up to 36x36 in size. The solver itself also supports finding &lt;em&gt;the best solution&lt;/em&gt; and not just any solution, which requires providing an &lt;em&gt;objective function&lt;/em&gt; as part of the problem, however this isn&amp;rsquo;t yet surfaced through the site. An example application would be picking words for a crossword that are more common and avoiding other words, like abbreviations. There are also other, &amp;ldquo;infrastructural&amp;rdquo; improvements, which I may get to in the future. I may also look to apply the solver to a new class of problems, but I&amp;rsquo;m not sure what those will be yet.&lt;/p&gt;&lt;p&gt;With that, I&amp;rsquo;ll close this post out with a quick plug for my solver for &lt;a href=&#34;https://dawnofthe.dad/ndoku&#34;&gt;NxN sudoku&lt;/a&gt; where you can see that by applying the techniques mentioned here the solver is able to find a solution for a 25x25 sudoku in a couple of seconds. In contrast, with a pure brute-force algorithm, we may need to consider an enormous number of states: $$(25 \times 25) ^ {25} = 7.889 \times 10^{69}$$&lt;/p&gt;</description>
     </item>
   
     <item>
       <title>Why tho</title>
       <link>https://blog.dawnofthe.dad/posts/why-tho/</link>
       <pubDate>Sat, 26 Aug 2023 21:00:03 +0000</pubDate>
       
       <guid>https://blog.dawnofthe.dad/posts/why-tho/</guid>
       <description>&lt;h2 id=&#34;what-and-why&#34;&gt;What and why?&lt;/h2&gt;&lt;p&gt;First, the &lt;strong&gt;what&lt;/strong&gt;: &lt;a href=&#34;https://dawnofthe.dad&#34;&gt;Dawn of the Dad&lt;/a&gt; is basically the 2 solvers: one for &lt;a href=&#34;https://dawnofthe.dad/sudoku&#34;&gt;sudoku&lt;/a&gt;, and another for &lt;a href=&#34;https://dawnofthe.dad/crossword&#34;&gt;building crosswords&lt;/a&gt;. The first is largely complete, so most of my time now is dedicated to beefing up the crossword builder.&lt;/p&gt;&lt;p&gt;Now the &lt;strong&gt;why&lt;/strong&gt;: why build the site and why ramble in this blog?&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;p&gt;The site is my excuse to write some code, both to stay sharp and because I like doing it, solve some algorithmically interesting problems, and revisit some of the neat things I&amp;rsquo;ve learned about back in grad school. Originally, this spun off as a yet-another-rewrite of a general-purpose &lt;a href=&#34;https://en.wikipedia.org/wiki/Constraint_satisfaction_problem&#34;&gt;CSP&lt;/a&gt; solver, which then led to adding fairly ad hoc visualization, which led to building a web server, hacking up a websocket protocol, glueing it all together and finally hosting it on Google Cloud.&lt;/p&gt;&lt;/li&gt;&lt;li&gt;&lt;p&gt;The blog is largely meant to capture some of the interesting things I&amp;rsquo;ve learned along the way, like tuning / optimizing the solver and dealing with the hug of death I got from that one time my site briefly hit the front page of &lt;a href=&#34;https://news.ycombinator.com/news&#34;&gt;Hacker News&lt;/a&gt;.&lt;/p&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2 id=&#34;post-frequency&#34;&gt;Post frequency&lt;/h2&gt;&lt;p&gt;I&amp;rsquo;ll probably end up writing a bunch of posts relatively quickly at first, as I&amp;rsquo;m catching up on a year&amp;rsquo;s worth of potentially interesting things to write down, before I forget them. Once I do, I expect things to slow down a fair bit.&lt;/p&gt;</description>
     </item>
   
 </channel>
</rss>
